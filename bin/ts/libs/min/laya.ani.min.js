!function(t,i,e){var a=(e.un,e.uns,e.static),s=e.class,r=e.getset,n=e.__newvec,h=laya.maths.Bezier,l=laya.utils.Browser,o=laya.utils.Byte,u=(laya.events.Event,laya.events.EventDispatcher),c=laya.display.Graphics,_=laya.utils.Handler,p=laya.net.Loader,d=laya.maths.MathUtil,f=laya.maths.Matrix,m=laya.renders.Render,y=laya.resource.Resource,x=laya.utils.RunDriver,g=laya.display.Sprite,v=laya.utils.Stat,D=laya.resource.Texture,M=laya.net.URL,I=laya.utils.Utils,b=(function(){function t(){}s(t,"laya.ani.AnimationState"),t.stopped=0,t.paused=1,t.playing=2,t}(),function(){function t(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new Y,this.resultMatrix=new f,this._children=[]}s(t,"laya.ani.bone.Bone");var i=t.prototype;return i.setTempMatrix=function(t){this._tempMatrix=t;var i,e=0,a=0;for(e=0,a=this._children.length;e<a;e++)i=this._children[e],i.setTempMatrix(this._tempMatrix)},i.update=function(t){this.rotation=this.transform.skX;var i;if(t)i=this.resultTransform.getMatrix(),f.mul(i,t,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)i=this.resultTransform.getMatrix(),f.mul(i,this.parentBone.resultMatrix,this.resultMatrix);else{var e=this.parentBone,a=NaN,s=NaN,r=NaN,n=this.parentBone.resultMatrix;i=this.resultTransform.getMatrix();var h=n.a*i.tx+n.c*i.ty+n.tx,l=n.b*i.tx+n.d*i.ty+n.ty,o=new f;this.inheritRotation?(a=Math.atan2(e.resultMatrix.b,e.resultMatrix.a),s=Math.cos(a),r=Math.sin(a),o.setTo(s,r,-r,s,0,0),f.mul(this._tempMatrix,o,f.TEMP),f.TEMP.copyTo(o),i=this.resultTransform.getMatrix(),f.mul(i,o,this.resultMatrix),this.resultMatrix.tx=h,this.resultMatrix.ty=l):(this.inheritScale,i=this.resultTransform.getMatrix(),f.TEMP.identity(),f.TEMP.d=this.d,f.mul(i,f.TEMP,this.resultMatrix),this.resultMatrix.tx=h,this.resultMatrix.ty=l)}else i=this.resultTransform.getMatrix(),i.copyTo(this.resultMatrix);var u,c=0,_=0;for(c=0,_=this._children.length;c<_;c++)u=this._children[c],u.update()},i.updateChild=function(){var t,i=0,e=0;for(i=0,e=this._children.length;i<e;i++)t=this._children[i],t.update()},i.setRotation=function(t){this._sprite&&(this._sprite.rotation=180*t/Math.PI)},i.updateDraw=function(i,a){t.ShowBones&&!t.ShowBones[this.name]||(this._sprite?(this._sprite.x=i+this.resultMatrix.tx,this._sprite.y=a+this.resultMatrix.ty):(this._sprite=new g,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),e.stage.addChild(this._sprite),this._sprite.x=i+this.resultMatrix.tx,this._sprite.y=a+this.resultMatrix.ty));var s,r=0,n=0;for(r=0,n=this._children.length;r<n;r++)s=this._children[r],s.updateDraw(i,a)},i.addChild=function(t){this._children.push(t),t.parentBone=this},i.findBone=function(t){if(this.name==t)return this;var i,e,a=0,s=0;for(a=0,s=this._children.length;a<s;a++)if(i=this._children[a],e=i.findBone(t))return e;return null},i.localToWorld=function(t){var i=t[0],e=t[1];t[0]=i*this.resultMatrix.a+e*this.resultMatrix.c+this.resultMatrix.tx,t[1]=i*this.resultMatrix.b+e*this.resultMatrix.d+this.resultMatrix.ty},t.ShowBones={},t}()),N=function(){function t(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}s(t,"laya.ani.bone.BoneSlot");var i=t.prototype;return i.showSlotData=function(t,i){void 0===i&&(i=!0),this.currSlotData=t,i&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},i.showDisplayByName=function(t){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(t))},i.replaceDisplayByName=function(t,i){if(this.currSlotData){var e=0;e=this.currSlotData.getDisplayByName(t);var a=0;a=this.currSlotData.getDisplayByName(i),this.replaceDisplayByIndex(e,a)}},i.replaceDisplayByIndex=function(t,i){this.currSlotData&&(this._replaceDic[t]=i,this.displayIndex==t&&this.showDisplayByIndex(t))},i.showDisplayByIndex=function(t){if(this._replaceDic[t]&&(t=this._replaceDic[t]),this.currSlotData&&t>-1&&t<this.currSlotData.displayArr.length){if(this.displayIndex=t,this.currDisplayData=this.currSlotData.displayArr[t],this.currDisplayData){var i=this.currDisplayData.name;this.currTexture=this.templet.getTexture(i),this.currTexture&&m.isWebGL&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},i.replaceSkin=function(t){this._diyTexture=t,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},i.setParentMatrix=function(t){this._parentMatrix=t},i.draw=function(i,e,a,s){if(void 0===a&&(a=!1),void 0===s&&(s=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var r=this.currTexture;this._diyTexture&&(r=this._diyTexture);var n;switch(this.currDisplayData.type){case 0:if(i){var h=this.getDisplayMatrix();if(this._parentMatrix){var l=!1;if(h){f.mul(h,this._parentMatrix,f.TEMP);var o;if(a?(null==this._resultMatrix&&(this._resultMatrix=new f),o=this._resultMatrix):o=new f,!m.isWebGL&&this.currDisplayData.uvs||m.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var u=t._tempMatrix;u.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(u.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(l=!0,u.rotate(-Math.PI/2)),f.mul(u,f.TEMP,o)}else f.TEMP.copyTo(o);l?i.drawTexture(r,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,o):i.drawTexture(r,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,o)}}}break;case 1:if(a?(null==this._skinSprite&&(this._skinSprite=x.skinAniSprite()),n=this._skinSprite):n=x.skinAniSprite(),null==n)return;var c;if(null==this.currDisplayData.bones){var _=this.currDisplayData.weights;this.deformData&&(_=this.deformData);var p;this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=V.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=V.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),p=this._curDiyUV):p=this.currDisplayData.uvs,this._mVerticleArr=_;this.currDisplayData.triangles.length;c=this.currDisplayData.triangles,n.init2(r,null,c,this._mVerticleArr,p);var d=this.getDisplayMatrix();if(this._parentMatrix&&d){f.mul(d,this._parentMatrix,f.TEMP);var y;a?(null==this._resultMatrix&&(this._resultMatrix=new f),y=this._resultMatrix):y=new f,f.TEMP.copyTo(y),n.transform=y}}else this.skinMesh(e,n,s);i.drawSkin(n);break;case 2:if(a?(null==this._skinSprite&&(this._skinSprite=x.skinAniSprite()),n=this._skinSprite):n=x.skinAniSprite(),null==n)return;this.skinMesh(e,n,s),i.drawSkin(n);break;case 3:}}},i.skinMesh=function(t,i,e){var a,s=this.currTexture,r=this.currDisplayData.bones;this._diyTexture?(s=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=V.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=V.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),a=this._curDiyUV):a=this.currDisplayData.uvs;var n,h,l=this.currDisplayData.weights,o=this.currDisplayData.triangles,u=0,c=0,_=0,p=NaN,d=NaN,f=0,m=0,y=[],x=0,g=0;if(this.deformData&&this.deformData.length>0){var v=0;for(x=0,g=r.length;x<g;){for(_=r[x++]+x,u=0,c=0;x<_;x++)h=t[r[x]],p=l[f]+this.deformData[v++],d=l[f+1]+this.deformData[v++],m=l[f+2],u+=(p*h.a+d*h.c+h.tx)*m,c+=(p*h.b+d*h.d+h.ty)*m,f+=3;y.push(u,c)}}else for(x=0,g=r.length;x<g;){for(_=r[x++]+x,u=0,c=0;x<_;x++)h=t[r[x]],p=l[f],d=l[f+1],m=l[f+2],u+=(p*h.a+d*h.c+h.tx)*m,c+=(p*h.b+d*h.d+h.ty)*m,f+=3;y.push(u,c)}this._mVerticleArr=y,n=o,i.init2(s,null,n,this._mVerticleArr,a)},i.drawBonePoint=function(t){t&&this._parentMatrix&&t.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},i.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},i.getMatrix=function(){return this._resultMatrix},i.copy=function(){var i=new t;return i.type="copy",i.name=this.name,i.attachmentName=this.attachmentName,i.srcDisplayIndex=this.srcDisplayIndex,i.parent=this.parent,i.displayIndex=this.displayIndex,i.templet=this.templet,i.currSlotData=this.currSlotData,i.currTexture=this.currTexture,i.currDisplayData=this.currDisplayData,i},a(t,["_tempMatrix",function(){return this._tempMatrix=new f}]),t}(),A=function(){function t(){this.skinName=null,this.deformSlotDataList=[]}return s(t,"laya.ani.bone.DeformAniData"),t}(),T=function(){function t(){this.deformSlotDisplayList=[]}return s(t,"laya.ani.bone.DeformSlotData"),t}(),S=function(){function t(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}s(t,"laya.ani.bone.DeformSlotDisplayData");var i=t.prototype;return i.binarySearch1=function(t,i){var e=0,a=t.length-2;if(0==a)return 1;for(var s=a>>>1;;){if(t[Math.floor(s+1)]<=i?e=s+1:a=s,e==a)return e+1;s=e+a>>>1}return 0},i.apply=function(t,i,e){if(void 0===e&&(e=1),t+=.05,!(this.timeList.length<=0)){var a=0;if(!(t<this.timeList[0])){var s=this.vectices[0].length,r=[],n=this.binarySearch1(this.timeList,t);if(this.frameIndex=n,t>=this.timeList[this.timeList.length-1]){var h=this.vectices[this.vectices.length-1];if(e<1)for(a=0;a<s;a++)r[a]+=(h[a]-r[a])*e;else for(a=0;a<s;a++)r[a]=h[a];return void(this.deformData=r)}var l=(this.tweenKeyList[this.frameIndex],this.vectices[this.frameIndex-1]),o=this.vectices[this.frameIndex],u=this.timeList[this.frameIndex-1],c=this.timeList[this.frameIndex];e=this.tweenKeyList[n-1]?(t-u)/(c-u):0;var _=NaN;for(a=0;a<s;a++)_=l[a],r[a]=_+(o[a]-_)*e;this.deformData=r}}},t}(),F=function(){function t(){this.time=NaN,this.drawOrder=[]}return s(t,"laya.ani.bone.DrawOrderData"),t}(),w=function(){function t(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return s(t,"laya.ani.bone.EventData"),t}(),C=function(){function t(t,i){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=t,this._targetBone=i[t.targetBoneIndex],this.isSpine=t.isSpine,null==this._bones&&(this._bones=[]),this._bones.length=0;for(var e=0,a=t.boneIndexs.length;e<a;e++)this._bones.push(i[t.boneIndexs[e]]);this.name=t.name,this.mix=t.mix,this.bendDirection=t.bendDirection}s(t,"laya.ani.bone.IkConstraint");var i=t.prototype;return i.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},i._applyIk1=function(i,e,a,s){var r=i.parentBone,n=1/(r.resultMatrix.a*r.resultMatrix.d-r.resultMatrix.b*r.resultMatrix.c),h=e-r.resultMatrix.tx,l=a-r.resultMatrix.ty,o=(h*r.resultMatrix.d-l*r.resultMatrix.c)*n-i.transform.x,u=(l*r.resultMatrix.a-h*r.resultMatrix.b)*n-i.transform.y,c=Math.atan2(u,o)*t.radDeg-0-i.transform.skX;i.transform.scX<0&&(c+=180),c>180?c-=360:c<-180&&(c+=360),i.transform.skX=i.transform.skY=i.transform.skX+c*s,i.update()},i.updatePos=function(t,i){this._sp&&this._sp.pos(t,i)},i._applyIk2=function(i,a,s,r,n,h){if(0!=h){var l=i.resultTransform.x,o=i.resultTransform.y,u=i.transform.scX,c=i.transform.scY,_=a.transform.scX,p=0,d=0,f=0;u<0?(u=-u,p=180,f=-1):(p=0,f=1),c<0&&(c=-c,f=-f),_<0?(_=-_,d=180):d=0;var m=a.resultTransform.x,y=NaN,x=NaN,v=NaN,D=i.resultMatrix.a,M=i.resultMatrix.c,I=i.resultMatrix.b,b=i.resultMatrix.d,N=Math.abs(u-c)<=1e-4;N?(y=a.resultTransform.y,x=D*m+M*y+i.resultMatrix.tx,v=I*m+b*y+i.resultMatrix.ty):(y=0,x=D*m+i.resultMatrix.tx,v=I*m+i.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new g,e.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(s,r,15,"#ffff00"),this._sp.graphics.drawCircle(x,v,15,"#ff00ff")),i.setRotation(Math.atan2(v-i.resultMatrix.ty,x-i.resultMatrix.tx));var A=i.parentBone;D=A.resultMatrix.a,M=A.resultMatrix.c,I=A.resultMatrix.b,b=A.resultMatrix.d;var T=1/(D*b-M*I),S=s-A.resultMatrix.tx,F=r-A.resultMatrix.ty,w=(S*b-F*M)*T-l,C=(F*D-S*I)*T-o;S=x-A.resultMatrix.tx,F=v-A.resultMatrix.ty;var k=(S*b-F*M)*T-l,P=(F*D-S*I)*T-o,B=Math.sqrt(k*k+P*P),U=a.length*_,L=NaN,R=NaN;if(N){U*=u;var O=(w*w+C*C-B*B-U*U)/(2*B*U);O<-1?O=-1:O>1&&(O=1),R=Math.acos(O)*n,D=B+U*O,M=U*Math.sin(R),L=Math.atan2(C*D-w*M,w*D+C*M)}else{D=u*U,M=c*U;var E=D*D,Y=M*M,V=w*w+C*C,X=Math.atan2(C,w);I=Y*B*B+E*V-E*Y;var K=-2*Y*B,W=Y-E;if((b=K*K-4*W*I)>0){var z=Math.sqrt(b);K<0&&(z=-z),z=-(K+z)/2;var q=z/W,G=I/z,H=Math.abs(q)<Math.abs(G)?q:G;H*H<=V&&(F=Math.sqrt(V-H*H)*n,L=X-Math.atan2(F,H),R=Math.atan2(F/c,(H-B)/u))}var Q=0,Z=Number.MAX_VALUE,$=0,j=0,J=0,tt=0,it=0,et=0;S=B+D,b=S*S,b>tt&&(J=0,tt=b,it=S),S=B-D,b=S*S,b<Z&&(Q=Math.PI,Z=b,$=S);var at=Math.acos(-D*B/(E-Y));S=D*Math.cos(at)+B,F=M*Math.sin(at),b=S*S+F*F,b<Z&&(Q=at,Z=b,$=S,j=F),b>tt&&(J=at,tt=b,it=S,et=F),V<=(Z+tt)/2?(L=X-Math.atan2(j*n,$),R=Q*n):(L=X-Math.atan2(et*n,it),R=J*n)}var st=Math.atan2(y,m)*f,rt=i.resultTransform.skX;L=(L-st)*t.radDeg+p-rt,L>180?L-=360:L<-180&&(L+=360),i.resultTransform.x=l,i.resultTransform.y=o,i.resultTransform.skX=i.resultTransform.skY=rt+L*h,rt=a.resultTransform.skX,rt%=360,R=((R+st)*t.radDeg-0)*f+d-rt,R>180?R-=360:R<-180&&(R+=360),a.resultTransform.x=m,a.resultTransform.y=y,a.resultTransform.skX=a.resultTransform.skY=a.resultTransform.skY+R*h,i.update()}},i._applyIk3=function(i,a,s,r,n,h){if(0!=h){var l=NaN,o=NaN,u=a.resultMatrix.a*a.length,c=a.resultMatrix.b*a.length,_=u*u+c*c,p=Math.sqrt(_),d=i.resultMatrix.tx,f=i.resultMatrix.ty,m=a.resultMatrix.tx,y=a.resultMatrix.ty,x=m-d,v=y-f,D=x*x+v*v,M=Math.sqrt(D);x=s-i.resultMatrix.tx,v=r-i.resultMatrix.ty;var I=x*x+v*v,b=Math.sqrt(I);if(p+M<=b||b+p<=M||b+M<=p){var N=NaN;N=p+M<=b?1:-1,m=d+N*(s-d)*M/b,y=f+N*(r-f)*M/b}else{var A=(D-_+I)/(2*I),T=Math.sqrt(D-A*A*I)/b,S=d+x*A,F=f+v*A,w=-v*T,C=x*T;n>0?(m=S-w,y=F-C):(m=S+w,y=F+C)}l=m,o=y,this.isDebug&&(this._sp||(this._sp=new g,e.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(d,f,15,"#ff00ff"),this._sp.graphics.drawCircle(s,r,15,"#ffff00"),this._sp.graphics.drawCircle(l,o,15,"#ff00ff"));var k=NaN;k=Math.atan2(o-i.resultMatrix.ty,l-i.resultMatrix.tx),i.setRotation(k);var P;P=t._tempMatrix,P.identity(),P.rotate(k),P.scale(i.resultMatrix.getScaleX(),i.resultMatrix.getScaleY()),P.translate(i.resultMatrix.tx,i.resultMatrix.ty),P.copyTo(i.resultMatrix),i.updateChild();var B=NaN;B=Math.atan2(r-o,s-l),a.setRotation(B);var U;U=t._tempMatrix,U.identity(),U.rotate(B),U.scale(a.resultMatrix.getScaleX(),a.resultMatrix.getScaleY()),U.translate(l,o),P.copyTo(a.resultMatrix),a.updateChild()}},a(t,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new f}]),t}(),k=function(){function t(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return s(t,"laya.ani.bone.IkConstraintData"),t}(),P=function(){function t(t,i){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=t,this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.bones=[];for(var e=this.data.bones,a=0,s=e.length;a<s;a++)this.bones.push(i[e[a]])}s(t,"laya.ani.bone.PathConstraint");var i=t.prototype;return i.apply=function(t,i){var e=this.translateMix,a=this.translateMix,s=a>0,r=this.data.spacingMode,n="length"==r,h=this.data.rotateMode,l="tangent"==h,o="chainScale"==h,u=[],c=this.bones.length,_=l?c:c+1,p=[];this._spaces=p,p[0]=this.position;var d=this.spacing;if(o||n)for(var f=0,m=_-1;f<m;){var y=this.bones[f],x=y.length,g=x*y.resultMatrix.a,v=x*y.resultMatrix.b;x=Math.sqrt(g*g+v*v),o&&(u[f]=x),p[++f]=n?Math.max(0,x+d):d}else for(f=1;f<_;f++)p[f]=d;var D=this.computeWorldPositions(this.target,t,i,_,l,"percent"==this.data.positionMode,"percent"==r);if(this._debugKey){for(f=0;f<D.length;f++)i.drawCircle(D[f++],D[f++],5,"#00ff00");var M=[];for(f=0;f<D.length;f++)M.push(D[f++],D[f++]);i.drawLines(0,0,M,"#ff0000")}var I=D[0],b=D[1],N=this.data.offsetRotation,A="chain"==h&&0==N,T=NaN;for(f=0,T=3;f<c;f++,T+=3){y=this.bones[f],y.resultMatrix.tx+=(I-y.resultMatrix.tx)*e,y.resultMatrix.ty+=(b-y.resultMatrix.ty)*e,g=D[T],v=D[T+1];var S=g-I,F=v-b;if(o&&0!=(x=u[f])){var w=(Math.sqrt(S*S+F*F)/x-1)*a+1;y.resultMatrix.a*=w,y.resultMatrix.c*=w}if(I=g,b=v,s){var C=y.resultMatrix.a,k=y.resultMatrix.c,P=y.resultMatrix.b,B=y.resultMatrix.d,U=NaN,L=NaN,R=NaN;U=l?D[T-1]:0==p[f+1]?D[T+2]:Math.atan2(F,S),U-=Math.atan2(P,C)-N/180*Math.PI,A&&(L=Math.cos(U),R=Math.sin(U),x=y.length,I+=(x*(L*C-R*P)-S)*a,b+=(x*(R*C+L*P)-F)*a),U>Math.PI?U-=2*Math.PI:U<-Math.PI&&(U+=2*Math.PI),U*=a,L=Math.cos(U),R=Math.sin(U),y.resultMatrix.a=L*C-R*P,y.resultMatrix.c=L*k-R*B,y.resultMatrix.b=R*C+L*P,y.resultMatrix.d=R*k+L*B}}},i.computeWorldVertices2=function(t,i,e,a,s,r){var n,h=t.currDisplayData.bones,l=t.currDisplayData.weights,o=(t.currDisplayData.triangles,0),u=0,c=0,_=0,p=0,d=0,f=0,m=0,y=0,x=0;for(o=0;o<e;o+=2)_=h[u],u+=_+1,c+=_;var g=i;for(p=r,d=3*c;p<a;p+=2){for(f=0,m=0,_=h[u++],_+=u;u<_;u++,d+=3){n=g[h[u]].resultMatrix,y=l[d],x=l[d+1];var v=l[d+2];f+=(y*n.a+x*n.c+n.tx)*v,m+=(y*n.b+x*n.d+n.ty)*v}s[p]=f,s[p+1]=m}},i.computeWorldPositions=function(t,i,e,a,s,r,n){var h=(t.currDisplayData.bones,t.currDisplayData.weights,t.currDisplayData.triangles,[]),l=0,o=t.currDisplayData.verLen,u=this.position,c=this._spaces,_=[],p=[],d=o/6,f=-1,m=NaN,y=0,x=0,g=NaN,v=NaN,D=NaN,M=NaN;if(d--,o-=4,this.computeWorldVertices2(t,i,2,o,h,0),this._debugKey)for(l=0;l<h.length;)e.drawCircle(h[l++],h[l++],10,"#ff0000");_=h,this._curves.length=d;var I=this._curves;m=0;var b=_[0],N=_[1],A=0,T=0,S=0,F=0,w=0,C=0,k=NaN,P=NaN,B=NaN,U=NaN,L=NaN,R=NaN,O=NaN,E=NaN,Y=0;for(l=0,Y=2;l<d;l++,Y+=6)A=_[Y],T=_[Y+1],S=_[Y+2],F=_[Y+3],w=_[Y+4],C=_[Y+5],k=.1875*(b-2*A+S),P=.1875*(N-2*T+F),B=.09375*(3*(A-S)-b+w),U=.09375*(3*(T-F)-N+C),L=2*k+B,R=2*P+U,O=.75*(A-b)+k+.16666667*B,E=.75*(T-N)+P+.16666667*U,m+=Math.sqrt(O*O+E*E),O+=L,E+=R,L+=B,R+=U,m+=Math.sqrt(O*O+E*E),O+=L,E+=R,m+=Math.sqrt(O*O+E*E),O+=L+B,E+=R+U,m+=Math.sqrt(O*O+E*E),I[l]=m,b=w,N=C;if(r&&(u*=m),n)for(l=0;l<a;l++)c[l]*=m;var V=this._segments,X=0,K=0;for(l=0,y=0,x=0,K=0;l<a;l++,y+=3)if(v=c[l],u+=v,(g=u)<0)this.addBeforePosition(g,_,0,p,y);else if(g>m)this.addAfterPosition(g-m,_,o-4,p,y);else{for(;;x++)if(M=I[x],!(g>M)){0==x?g/=M:(D=I[x-1],g=(g-D)/(M-D));break}if(x!=f){f=x;var W=6*x;for(b=_[W],N=_[W+1],A=_[W+2],T=_[W+3],S=_[W+4],F=_[W+5],w=_[W+6],C=_[W+7],k=.03*(b-2*A+S),P=.03*(N-2*T+F),B=.006*(3*(A-S)-b+w),U=.006*(3*(T-F)-N+C),L=2*k+B,R=2*P+U,O=.3*(A-b)+k+.16666667*B,E=.3*(T-N)+P+.16666667*U,X=Math.sqrt(O*O+E*E),V[0]=X,W=1;W<8;W++)O+=L,E+=R,L+=B,R+=U,X+=Math.sqrt(O*O+E*E),V[W]=X;O+=L,E+=R,X+=Math.sqrt(O*O+E*E),V[8]=X,O+=L+B,E+=R+U,X+=Math.sqrt(O*O+E*E),V[9]=X,K=0}for(g*=X;;K++)if(M=V[K],!(g>M)){0==K?g/=M:(D=V[K-1],g=K+(g-D)/(M-D));break}this.addCurvePosition(.1*g,b,N,A,T,S,F,w,C,p,y,s||l>0&&0==v)}return p},i.addBeforePosition=function(t,i,e,a,s){var r=i[e],n=i[e+1],h=i[e+2]-r,l=i[e+3]-n,o=Math.atan2(l,h);a[s]=r+t*Math.cos(o),a[s+1]=n+t*Math.sin(o),a[s+2]=o},i.addAfterPosition=function(t,i,e,a,s){var r=i[e+2],n=i[e+3],h=r-i[e],l=n-i[e+1],o=Math.atan2(l,h);a[s]=r+t*Math.cos(o),a[s+1]=n+t*Math.sin(o),a[s+2]=o},i.addCurvePosition=function(t,i,e,a,s,r,n,h,l,o,u,c){0==t&&(t=1e-4);var _=t*t,p=_*t,d=1-t,f=d*d,m=f*d,y=d*t,x=3*y,g=d*x,v=x*t,D=i*m+a*g+r*v+h*p,M=e*m+s*g+n*v+l*p;o[u]=D,o[u+1]=M,o[u+2]=c?Math.atan2(M-(e*f+s*y*2+n*_),D-(i*f+a*y*2+r*_)):0},t.NONE=-1,t.BEFORE=-2,t.AFTER=-3,t}(),B=function(){function t(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return s(t,"laya.ani.bone.PathConstraintData"),t}(),U=function(){function t(){this.name=null,this.slotArr=[]}return s(t,"laya.ani.bone.SkinData"),t}(),L=function(){function t(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}s(t,"laya.ani.bone.SkinSlotDisplayData");var i=t.prototype;return i.createTexture=function(t){return this.texture?this.texture:(this.texture=new D(t.bitmap,this.uvs),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=t.height,this.texture.height=t.width,this.texture.offsetX=-t.offsetX,this.texture.offsetY=-t.offsetY,this.texture.sourceWidth=t.sourceHeight,this.texture.sourceHeight=t.sourceWidth):(this.texture.width=t.width,this.texture.height=t.height,this.texture.offsetX=-t.offsetX,this.texture.offsetY=-t.offsetY,this.texture.sourceWidth=t.sourceWidth,this.texture.sourceHeight=t.sourceHeight),this.texture)},i.destory=function(){this.texture&&this.texture.destroy()},t}(),R=function(){function t(){this.name=null,this.displayArr=[]}return s(t,"laya.ani.bone.SlotData"),t.prototype.getDisplayByName=function(t){for(var i,e=0,a=this.displayArr.length;e<a;e++)if(i=this.displayArr[e],i.attachmentName==t)return e;return-1},t}(),O=function(){function t(t,i){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=n(2,0),this._data=t,null==this._bones&&(this._bones=[]),this.target=i[t.targetIndex];var e=0,a=0;for(e=0,a=t.boneIndexs.length;e<a;e++)this._bones.push(i[t.boneIndexs[e]]);this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix}return s(t,"laya.ani.bone.TfConstraint"),t.prototype.apply=function(){for(var t,i=this.target.resultMatrix.a,e=this.target.resultMatrix.b,a=this.target.resultMatrix.c,s=this.target.resultMatrix.d,r=0,n=this._bones.length;r<n;r++){if(t=this._bones[r],this.rotateMix>0){var h=t.resultMatrix.a,l=t.resultMatrix.b,o=t.resultMatrix.c,u=t.resultMatrix.d,c=Math.atan2(a,i)-Math.atan2(o,h)+this._data.offsetRotation*Math.PI/180;c>Math.PI?c-=2*Math.PI:c<-Math.PI&&(c+=2*Math.PI),c*=this.rotateMix;var _=Math.cos(c),p=Math.sin(c);t.resultMatrix.a=_*h-p*o,t.resultMatrix.b=_*l-p*u,t.resultMatrix.c=p*h+_*o,t.resultMatrix.d=p*l+_*u}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),t.resultMatrix.tx+=(this._temp[0]-t.resultMatrix.tx)*this.translateMix,t.resultMatrix.ty+=(this._temp[1]-t.resultMatrix.ty)*this.translateMix,t.updateChild()),this.scaleMix>0){var d=Math.sqrt(t.resultMatrix.a*t.resultMatrix.a+t.resultMatrix.c*t.resultMatrix.c),f=Math.sqrt(i*i+a*a),m=d>1e-5?(d+(f-d+this._data.offsetScaleX)*this.scaleMix)/d:0;t.resultMatrix.a*=m,t.resultMatrix.c*=m,d=Math.sqrt(t.resultMatrix.b*t.resultMatrix.b+t.resultMatrix.d*t.resultMatrix.d),f=Math.sqrt(e*e+s*s),m=d>1e-5?(d+(f-d+this._data.offsetScaleY)*this.scaleMix)/d:0,t.resultMatrix.b*=m,t.resultMatrix.d*=m}if(this.shearMix>0){l=t.resultMatrix.b,u=t.resultMatrix.d;var y=Math.atan2(u,l);c=Math.atan2(s,e)-Math.atan2(a,i)-(y-Math.atan2(t.resultMatrix.c,t.resultMatrix.a)),c>Math.PI?c-=2*Math.PI:c<-Math.PI&&(c+=2*Math.PI),c=y+(c+this._data.offsetShearY*Math.PI/180)*this.shearMix,m=Math.sqrt(l*l+u*u),t.resultMatrix.b=Math.cos(c)*m,t.resultMatrix.d=Math.sin(c)*m}}},t}(),E=function(){function t(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return s(t,"laya.ani.bone.TfConstraintData"),t}(),Y=function(){function t(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}s(t,"laya.ani.bone.Transform");var i=t.prototype;return i.initData=function(t){void 0!=t.x&&(this.x=t.x),void 0!=t.y&&(this.y=t.y),void 0!=t.skX&&(this.skX=t.skX),void 0!=t.skY&&(this.skY=t.skY),void 0!=t.scX&&(this.scX=t.scX),void 0!=t.scY&&(this.scY=t.scY)},i.getMatrix=function(){var t;return t=this.mMatrix?this.mMatrix:this.mMatrix=new f,t.identity(),t.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(t,this.skewX*Math.PI/180,this.skewY*Math.PI/180),t.rotate(this.skX*Math.PI/180),t.translate(this.x,this.y),t},i.skew=function(t,i,e){var a=Math.sin(e),s=Math.cos(e),r=Math.sin(i),n=Math.cos(i);return t.setTo(t.a*n-t.b*a,t.a*r+t.b*s,t.c*n-t.d*a,t.c*r+t.d*s,t.tx*n-t.ty*a,t.tx*r+t.ty*s),t},t}(),V=function(){function t(){}return s(t,"laya.ani.bone.UVTools"),t.getRelativeUV=function(t,i,e){var a=t[0],s=t[2]-t[0],r=t[1],n=t[5]-t[1];e||(e=[]),e.length=i.length;var h=0,l=0;l=e.length;var o=1/s,u=1/n;for(h=0;h<l;h+=2)e[h]=(i[h]-a)*o,e[h+1]=(i[h+1]-r)*u;return e},t.getAbsoluteUV=function(t,i,e){if(0==t[0]&&0==t[1]&&1==t[4]&&1==t[5])return e?(I.copyArray(e,i),e):i;var a=t[0],s=t[2]-t[0],r=t[1],n=t[5]-t[1];e||(e=[]),e.length=i.length;var h=0,l=0;for(l=e.length,h=0;h<l;h+=2)e[h]=i[h]*s+a,e[h+1]=i[h+1]*n+r;return e},t}(),X=function(){function t(){}return s(t,"laya.ani.math.BezierLerp"),t.getBezierRate=function(i,e,a,s,r){var n=t._getBezierParamKey(e,a,s,r),h=100*n+i;if(t._bezierResultCache[h])return t._bezierResultCache[h];var l=t._getBezierPoints(e,a,s,r,n),o=0,u=0;for(u=l.length,o=0;o<u;o+=2)if(i<=l[o])return t._bezierResultCache[h]=l[o+1],l[o+1];return t._bezierResultCache[h]=1,1},t._getBezierParamKey=function(t,i,e,a){return 100*(100*(100*(100*t+i)+e)+a)},t._getBezierPoints=function(i,e,a,s,r){if(t._bezierPointsCache[r])return t._bezierPointsCache[r];var n;n=[0,0,i,e,a,s,1,1];var l;l=new h;var o;return o=l.getBezierPoints(n,100,3),t._bezierPointsCache[r]=o,o},t._bezierResultCache={},t._bezierPointsCache={},t}(),K=function(t){function i(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!0,i.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60}s(i,"laya.ani.AnimationPlayer",t);var a=i.prototype;return e.imps(a,{"laya.resource.IDestroy":!0}),a._onTempletLoadedComputeFullKeyframeIndices=function(t,i,e){this._templet===e&&this._cachePlayRate===t&&this._cacheFrameRate===i&&this._computeFullKeyframeIndices()},a._computeFullKeyframeIndices=function(){for(var t=this._fullFrames=[],i=this._templet,e=this._cacheFrameRateInterval*this._cachePlayRate,a=0,s=i.getAnimationCount();a<s;a++){for(var r=[],n=0,h=i.getAnimation(a).nodes.length;n<h;n++){for(var l=i.getAnimation(a).nodes[n],o=Math.floor(l.playTime/e+.01),u=new Uint16Array(o+1),c=-1,_=0,p=l.keyFrame.length;_<p;_++){var d=l.keyFrame[_],f=d.startTime,m=f+d.duration+e;do{for(var y=Math.floor(f/e+.5),x=c+1;x<y;x++)u[x]=_;c=y,u[y]=_,f+=e}while(f<=m)}r.push(u)}t.push(r)}},a._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},a._calculatePlayDuration=function(){if(0!==this.state){var t=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=t),this._playEnd>t&&(this._playEnd=t),this._playDuration=this._playEnd-this._playStart}},a._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},a.play=function(t,i,e,a,s){if(void 0===t&&(t=0),void 0===i&&(i=1),void 0===e&&(e=2147483647),void 0===a&&(a=0),void 0===s&&(s=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(e<0||a<0||s<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==s&&a>s)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=i,this._overallDuration=e,this._playStart=a,this._playEnd=s,this._paused=!1,this._currentAnimationClipIndex=t,this._currentKeyframeIndex=0,this._startUpdateLoopCount=v.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this.update(0)},a.playByFrame=function(t,i,e,a,s,r){void 0===t&&(t=0),void 0===i&&(i=1),void 0===e&&(e=2147483647),void 0===a&&(a=0),void 0===s&&(s=0),void 0===r&&(r=30);var n=1e3/r;this.play(t,i,e,a*n,s*n)},a.stop=function(t){void 0===t&&(t=!0),t?(this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},a.update=function(t){if(this._currentAnimationClipIndex!==-1&&!this._paused&&this._templet&&this._templet.loaded){var i=this._cacheFrameRateInterval*this._cachePlayRate,e=0;this._startUpdateLoopCount!==v.loopCount&&(e=t*this.playbackRate,this._elapsedPlaybackTime+=e);var a=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=a)return this._currentTime=a,this._currentKeyframeIndex=Math.floor(a/i+.01),this._currentFrameTime=this._currentKeyframeIndex*i,this._currentAnimationClipIndex=-1,void this.event("stopped");if(e+=this._currentTime,a>0){for(;e>=a;){if(this._stopWhenCircleFinish)return this._currentAnimationClipIndex=-1,this._stopWhenCircleFinish=!1,void this.event("stopped");e-=a,this.event("complete")}this._currentTime=e,this._currentKeyframeIndex=Math.floor(this.currentPlayTime/i),this._currentFrameTime=this._currentKeyframeIndex*i}else{if(this._stopWhenCircleFinish)return this._currentAnimationClipIndex=-1,this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},r(0,a,"playEnd",function(){return this._playEnd}),r(0,a,"templet",function(){return this._templet},function(t){0===!this.state&&this.stop(!0),this._templet!==t&&(this._templet=t,t.loaded?this._computeFullKeyframeIndices():t.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),r(0,a,"playStart",function(){return this._playStart}),r(0,a,"playDuration",function(){return this._playDuration}),r(0,a,"state",function(){
return this._currentAnimationClipIndex===-1?0:this._paused?1:2}),r(0,a,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),r(0,a,"overallDuration",function(){return this._overallDuration}),r(0,a,"currentFrameTime",function(){return this._currentFrameTime}),r(0,a,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),r(0,a,"currentPlayTime",function(){return this._currentTime+this._playStart}),r(0,a,"cachePlayRate",function(){return this._cachePlayRate},function(t){this._cachePlayRate!==t&&(this._cachePlayRate=t,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[t,this._cacheFrameRate])))}),r(0,a,"cacheFrameRate",function(){return this._cacheFrameRate},function(t){this._cacheFrameRate!==t&&(this._cacheFrameRate=t,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,t])))}),r(0,a,"currentTime",null,function(t){if(this._currentAnimationClipIndex!==-1&&this._templet&&this._templet.loaded){if(t<this._playStart||t>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=v.loopCount;var i=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=t,this._currentKeyframeIndex=Math.floor(this.currentPlayTime/i),this._currentFrameTime=this._currentKeyframeIndex*i}}),r(0,a,"paused",function(){return this._paused},function(t){this._paused=t,t&&this.event("paused")}),r(0,a,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),r(0,a,"destroyed",function(){return this._destroyed}),i}(u),W=function(t){function i(){i.__super.call(this),m.isConchNode&&(this.drawSkin=function(t){t.transform||(t.transform=f.EMPTY),this.setSkinMesh&&this.setSkinMesh(t._ps,t.mVBData,t.mEleNum,0,t.mTexture,t.transform)})}return s(i,"laya.ani.GraphicsAni",t),i.prototype.drawSkin=function(t){var i=[t];this._saveToCmd(m._context._drawSkin,i)},i}(c),z=function(t){function i(){this._aniMap={},this.unfixedLastAniIndex=-1,i.__super.call(this),this._anis=new Array}s(i,"laya.ani.AnimationTemplet",t);var a=i.prototype;return a._endLoaded=function(){this._loaded=!0,this.event("loaded",this)},a.parse=function(t){var e=0,a=0,s=0,r=0,n=0,h=0,l=0,u=new o(t);this._aniVersion=u.readUTFString();var c=u.readUTFString();this.aniClassName=c;var _,p=u.readUTFString().split("\n"),d=u.getUint8(),f=u.getUint32(),m=u.getUint32();f>0&&(_=t.slice(f,m));var y=new o(_);for(m>0&&(this._publicExtData=t.slice(m,t.byteLength)),this._useParent=!!u.getUint8(),this._anis.length=d,e=0;e<d;e++){var x=this._anis[e]={};x.nodes=new Array;var g=x.name=p[u.getUint16()];this._aniMap[g]=e,x.bone3DMap={},x.playTime=u.getFloat32();var v=x.nodes.length=u.getUint8();for(x.totalKeyframesLength=0,a=0;a<v;a++){var D=x.nodes[a]={};D.childs=[];var M=u.getInt16();M>=0&&(D.name=p[M],x.bone3DMap[D.name]=a),D.keyFrame=new Array,D.parentIndex=u.getInt16(),D.parentIndex==-1?D.parent=null:D.parent=x.nodes[D.parentIndex],D.lerpType=u.getUint8();var I=u.getUint32();y.pos=I;var b=D.keyframeWidth=y.getUint16();if(x.totalKeyframesLength+=b,0===D.lerpType||1===D.lerpType)for(D.interpolationMethod=[],D.interpolationMethod.length=b,s=0;s<b;s++)D.interpolationMethod[s]=i.interpolation[y.getUint8()];null!=D.parent&&D.parent.childs.push(D);var N=u.getUint16();N>0&&(D.extenData=t.slice(u.pos,u.pos+N),u.pos+=N);var A=u.getUint16();D.keyFrame.length=A;var T=0;for(s=0,r=A;s<r;s++){var S=D.keyFrame[s]={};if(S.duration=u.getFloat32(),S.startTime=T,2===D.lerpType){S.interpolationData=[];var F=u.getUint8(),w=0;switch(w=u.getFloat32()){case 254:for(S.interpolationData.length=b,l=0;l<b;l++)S.interpolationData[l]=0;break;case 255:for(S.interpolationData.length=b,l=0;l<b;l++)S.interpolationData[l]=5;break;default:for(S.interpolationData.push(w),h=1;h<F;h++)S.interpolationData.push(u.getFloat32())}}for(S.data=new Float32Array(b),S.dData=new Float32Array(b),S.nextData=new Float32Array(b),n=0;n<b;n++)S.data[n]=u.getFloat32(),S.data[n]>-1e-8&&S.data[n]<1e-8&&(S.data[n]=0);T+=S.duration}D.playTime=x.playTime,this._calculateKeyFrame(D,A,b)}}},a._calculateKeyFrame=function(t,i,e){var a=t.keyFrame;a[i]=a[0];for(var s=0;s<i;s++)for(var r=a[s],n=0;n<e;n++)r.dData[n]=0===r.duration?0:(a[s+1].data[n]-r.data[n])/r.duration,r.nextData[n]=a[s+1].data[n];a.length--},a.onAsynLoaded=function(t,i,e){this.parse(i),this._endLoaded()},a.getAnimationCount=function(){return this._anis.length},a.getAnimation=function(t){return this._anis[t]},a.getAniDuration=function(t){return this._anis[t].playTime},a.getNodes=function(t){return this._anis[t].nodes},a.getNodeIndexWithName=function(t,i){return this._anis[t].bone3DMap[i]},a.getNodeCount=function(t){return this._anis[t].nodes.length},a.getTotalkeyframesLength=function(t){return this._anis[t].totalKeyframesLength},a.getPublicExtData=function(){return this._publicExtData},a.getAnimationDataWithCache=function(t,i,e,a){var s=i[e];if(s){var r=s[t];return r?r[a]:null}return null},a.setAnimationDataWithCache=function(t,i,e,a,s){var r=i[e]||(i[e]={});(r[t]||(r[t]=[]))[a]=s},a.getOriginalData=function(t,e,a,s,r){for(var n=this._anis[t],h=n.nodes,l=0,o=0,u=h.length,c=0;o<u;o++){var _,p=h[o];_=p.keyFrame[a[o][s]],p.dataOffset=c;var d=r-_.startTime;switch(p.lerpType){case 0:case 1:for(l=0;l<p.keyframeWidth;)l+=p.interpolationMethod[l](p,l,e,c+l,_.data,d,_.dData,_.duration,_.nextData);break;case 2:var f=_.interpolationData,m=f.length,y=0;for(l=0;l<m;){var x=f[l];switch(x){case 6:l+=i.interpolation[x](p,y,e,c+y,_.data,d,_.dData,_.duration,_.nextData,f,l+1);break;case 7:l+=i.interpolation[x](p,y,e,c+y,_.data,d,_.dData,_.duration,_.nextData,f,l+1);break;default:l+=i.interpolation[x](p,y,e,c+y,_.data,d,_.dData,_.duration,_.nextData)}y++}}c+=p.keyframeWidth}},a.getNodesCurrentFrameIndex=function(t,i){var e=this._anis[t],a=e.nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(a.length),this.unfixedCurrentTimes=new Float32Array(a.length),this.unfixedLastAniIndex=t);for(var s=0,r=a.length;s<r;s++){var n=a[s];for(i<this.unfixedCurrentTimes[s]&&(this.unfixedCurrentFrameIndexes[s]=0),this.unfixedCurrentTimes[s]=i;this.unfixedCurrentFrameIndexes[s]<n.keyFrame.length&&!(n.keyFrame[this.unfixedCurrentFrameIndexes[s]].startTime>this.unfixedCurrentTimes[s]);)this.unfixedCurrentFrameIndexes[s]++;this.unfixedCurrentFrameIndexes[s]--}return this.unfixedCurrentFrameIndexes},a.getOriginalDataUnfixedRate=function(t,e,a){var s=this._anis[t],r=s.nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(r.length),this.unfixedCurrentTimes=new Float32Array(r.length),this.unfixedKeyframes=n(r.length),this.unfixedLastAniIndex=t);for(var h=0,l=0,o=r.length,u=0;l<o;l++){var c=r[l];for(a<this.unfixedCurrentTimes[l]&&(this.unfixedCurrentFrameIndexes[l]=0),this.unfixedCurrentTimes[l]=a;this.unfixedCurrentFrameIndexes[l]<c.keyFrame.length&&!(c.keyFrame[this.unfixedCurrentFrameIndexes[l]].startTime>this.unfixedCurrentTimes[l]);)this.unfixedKeyframes[l]=c.keyFrame[this.unfixedCurrentFrameIndexes[l]],this.unfixedCurrentFrameIndexes[l]++;var _=this.unfixedKeyframes[l];c.dataOffset=u;var p=a-_.startTime;switch(c.lerpType){case 0:case 1:for(h=0;h<c.keyframeWidth;)h+=c.interpolationMethod[h](c,h,e,u+h,_.data,p,_.dData,_.duration,_.nextData);break;case 2:var d=_.interpolationData,f=d.length,m=0;for(h=0;h<f;){var y=d[h];switch(y){case 6:h+=i.interpolation[y](c,m,e,u+m,_.data,p,_.dData,_.duration,_.nextData,d,h+1);break;case 7:h+=i.interpolation[y](c,m,e,u+m,_.data,p,_.dData,_.duration,_.nextData,d,h+1);break;default:h+=i.interpolation[y](c,m,e,u+m,_.data,p,_.dData,_.duration,_.nextData)}m++}}u+=c.keyframeWidth}},a.dispose=function(){this.resourceManager&&this.resourceManager.removeResource(this),t.prototype.dispose.call(this)},i._LinearInterpolation_0=function(t,i,e,a,s,r,n,h,l,o){return e[a]=s[i]+r*n[i],1},i._QuaternionInterpolation_1=function(t,i,e,a,s,r,n,h,l,o){var u=0===h?0:r/h;return d.slerpQuaternionArray(s,i,l,i,u,e,a),4},i._AngleInterpolation_2=function(t,i,e,a,s,r,n,h,l,o){return 0},i._RadiansInterpolation_3=function(t,i,e,a,s,r,n,h,l,o){return 0},i._Matrix4x4Interpolation_4=function(t,i,e,a,s,r,n,h,l,o){for(var u=0;u<16;u++,i++)e[a+u]=s[i]+r*n[i];return 16},i._NoInterpolation_5=function(t,i,e,a,s,r,n,h,l,o){return e[a]=s[i],1},i._BezierInterpolation_6=function(t,i,e,a,s,r,n,h,l,o,u){return void 0===u&&(u=0),e[a]=s[i]+(l[i]-s[i])*X.getBezierRate(r/h,o[u],o[u+1],o[u+2],o[u+3]),5},i._BezierInterpolation_7=function(t,i,e,a,s,r,n,h,l,o,u){return void 0===u&&(u=0),e[a]=o[u+4]+o[u+5]*X.getBezierRate((.001*r+o[u+6])/o[u+7],o[u],o[u+1],o[u+2],o[u+3]),9},i.load=function(t){return e.loader.create(t,null,null,i)},i.interpolation=[i._LinearInterpolation_0,i._QuaternionInterpolation_1,i._AngleInterpolation_2,i._RadiansInterpolation_3,i._Matrix4x4Interpolation_4,i._NoInterpolation_5,i._BezierInterpolation_6,i._BezierInterpolation_7],i.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",i}(y),q=function(t){function i(t,e){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,i.__super.call(this),void 0===e&&(e=0),t&&this.init(t,e)}s(i,"laya.ani.bone.Skeleton",t);var a=i.prototype;return a.init=function(t,i){void 0===i&&(i=0);var e=0,a=0;if(1==i)for(this._graphicsCache=[],e=0,a=t.getAnimationCount();e<a;e++)this._graphicsCache.push([]);if(this._yReverseMatrix=t.yReverseMatrix,this._aniMode=i,this._templet=t,this._player=new K,this._player.cacheFrameRate=t.rate,this._player.templet=t,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=t.mBoneArr,this._rootBone=t.mRootBone,this._aniSectionDic=t.aniSectionDic,t.ikArr.length>0)for(this._ikArr=[],e=0,a=t.ikArr.length;e<a;e++)this._ikArr.push(new C(t.ikArr[e],this._boneList));if(t.pathArr.length>0){var s,r;null==this._pathDic&&(this._pathDic={});var n;for(e=0,a=t.pathArr.length;e<a;e++)s=t.pathArr[e],r=new P(s,this._boneList),n=this._boneSlotDic[s.name],n&&(r=new P(s,this._boneList),r.target=n),this._pathDic[s.name]=r}if(t.tfArr.length>0)for(this._tfArr=[],e=0,a=t.tfArr.length;e<a;e++)this._tfArr.push(new O(t.tfArr[e],this._boneList));if(t.skinDataArray.length>0){var h=this._templet.skinDataArray[this._skinIndex];this._skinName=h.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},a.load=function(t,i,a){void 0===a&&(a=0),this._aniPath=t,this._complete=i,this._loadAniMode=a,this._texturePath=t.replace(".sk",".png").replace(".bin",".png"),e.loader.load([{url:t,type:"arraybuffer"},{url:this._texturePath,type:"image"}],_.create(this,this._onLoaded))},a._onLoaded=function(){var t=p.getRes(this._texturePath),i=p.getRes(this._aniPath);if(null!=t&&null!=i){null==G.TEMPLET_DICTIONARY&&(G.TEMPLET_DICTIONARY={});var e;e=G.TEMPLET_DICTIONARY[this._aniPath],e?e.isParseFail?this._parseFail():this._parseComplete():(e=new G,e.url=this._aniPath,G.TEMPLET_DICTIONARY[this._aniPath]=e,e.on("complete",this,this._parseComplete),e.on("error",this,this._parseFail),e.parseData(t,i))}},a._parseComplete=function(){var t=G.TEMPLET_DICTIONARY[this._aniPath];t&&(this.init(t,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},a._parseFail=function(){console.log("[Error]:"+this._aniPath+"解析失败")},a._onPlay=function(){this.event("played")},a._onStop=function(){var t,i=this._templet.eventAniArr,e=i[this._aniClipIndex];if(e&&this._eventIndex<e.length)for(;this._eventIndex<e.length;this._eventIndex++)t=e[this._eventIndex],t.time>=this._player.playStart&&t.time<=this._player.playEnd&&this.event("label",t);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},a._onPause=function(){this.event("paused")},a._parseSrcBoneMatrix=function(){var t=0,i=0;for(i=this._templet.srcBoneMatrixArr.length,t=0;t<i;t++)this._boneMatrixArray.push(new f);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var e,a,s=this._templet.boneSlotArray;for(t=0,i=s.length;t<i;t++)e=s[t],a=this._bindBoneBoneSlotDic[e.parent],null==a&&(this._bindBoneBoneSlotDic[e.parent]=a=[]),this._boneSlotDic[e.name]=e=e.copy(),a.push(e),this._boneSlotArray.push(e)}},a._emitMissedEvents=function(t,i,e){void 0===e&&(e=0);var a=this._templet.eventAniArr,s=a[this._player.currentAnimationClipIndex];if(s){var r,n=0,h=0;for(h=s.length,n=e;n<h;n++)r=s[n],r.time>=this._player.playStart&&r.time<=this._player.playEnd&&this.event("label",r)}},a._update=function(t){if(void 0===t&&(t=!0),!(this._pause||t&&this._indexControl)){var i=e.timer.currTimer,a=this._player.currentKeyframeIndex;if(t?this._player.update(i-this._lastTime):a=-1,this._lastTime=i,this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||this._clipIndex==a&&this._lastUpdateAniClipIndex==this._aniClipIndex)){this._lastUpdateAniClipIndex=this._aniClipIndex,a>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var s,r=this._templet.eventAniArr,n=r[this._aniClipIndex];n&&this._eventIndex<n.length&&(s=n[this._eventIndex],s.time>=this._player.playStart&&s.time<=this._player.playEnd?this._player.currentPlayTime>=s.time&&(this.event("label",s),this._eventIndex++):this._eventIndex++);var h;if(0==this._aniMode){if(h=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=h&&(this.graphics=h));var l=0,o=0;for(o=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,o-1)&&o>0;)o--;if(o<this._clipIndex)for(l=o;l<this._clipIndex;l++)this._createGraphics(l)}else if(1==this._aniMode){if(h=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=h&&(this.graphics=h));for(o=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,o-1)&&o>0;)o--;if(o<this._clipIndex)for(l=o;l<this._clipIndex;l++)this._createGraphics(l)}this._createGraphics()}}},a._createGraphics=function(t){void 0===t&&(t=-1),t==-1&&(t=this._clipIndex);var i,e=t*this._player.cacheFrameRateInterval,a=this._templet.drawOrderAniArr,s=a[this._aniClipIndex];if(s&&s.length>0)for(this._drawOrderIndex=0,i=s[this._drawOrderIndex];e>=i.time&&(this._drawOrder=i.drawOrder,!(++this._drawOrderIndex>=s.length));)i=s[this._drawOrderIndex];var r;0==this._aniMode||1==this._aniMode?this.graphics=new W:this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=new W,r=this.graphics;var n=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],t,e);var h,l,u,c,_=this._aniSectionDic[this._aniClipIndex],p=0,d=0,m=0,y=0,x=0,g=this._templet.srcBoneMatrixArr.length;for(d=0,x=_[0];d<g;d++)c=this._boneList[d],u=this._templet.srcBoneMatrixArr[d],c.resultTransform.scX=u.scX*this._curOriginalData[p++],c.resultTransform.skX=u.skX+this._curOriginalData[p++],c.resultTransform.skY=u.skY+this._curOriginalData[p++],c.resultTransform.scY=u.scY*this._curOriginalData[p++],c.resultTransform.x=u.x+this._curOriginalData[p++],c.resultTransform.y=u.y+this._curOriginalData[p++],8===this._templet.tMatrixDataLen&&(c.resultTransform.skewX=u.skewX+this._curOriginalData[p++],c.resultTransform.skewY=u.skewY+this._curOriginalData[p++]);var v,D={},M={};for(x+=_[1];d<x;d++)v=n[d],D[v.name]=this._curOriginalData[p++],M[v.name]=this._curOriginalData[p++],this._curOriginalData[p++],this._curOriginalData[p++],this._curOriginalData[p++],this._curOriginalData[p++];var I={},b={};for(x+=_[2];d<x;d++)v=n[d],I[v.name]=this._curOriginalData[p++],b[v.name]=this._curOriginalData[p++],this._curOriginalData[p++],this._curOriginalData[p++],this._curOriginalData[p++],this._curOriginalData[p++];if(this._pathDic){var N;for(x+=_[3];d<x;d++)if(v=n[d],N=this._pathDic[v.name]){var A=new o(v.extenData);switch(A.getByte()){case 1:N.position=this._curOriginalData[p++];break;case 2:N.spacing=this._curOriginalData[p++];break;case 3:N.rotateMix=this._curOriginalData[p++],N.translateMix=this._curOriginalData[p++]}}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(f.TEMP.identity()),this._ikArr){var T;for(d=0,x=this._ikArr.length;d<x;d++)T=this._ikArr[d],I.hasOwnProperty(T.name)&&(T.bendDirection=I[T.name]),b.hasOwnProperty(T.name)&&(T.mix=b[T.name]),T.apply()}if(this._pathDic)for(var S in this._pathDic)N=this._pathDic[S],N.apply(this._boneList,r);if(this._tfArr){var F;for(d=0,y=this._tfArr.length;d<y;d++)F=this._tfArr[d],F.apply()}for(d=0,y=this._boneList.length;d<y;d++)if(c=this._boneList[d],l=this._bindBoneBoneSlotDic[c.name],c.resultMatrix.copyTo(this._boneMatrixArray[d]),l)for(m=0,x=l.length;m<x;m++)(h=l[m])&&h.setParentMatrix(c.resultMatrix);var w,C={},k=this._templet.deformAniArr;if(k&&k.length>0){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,d=0,x=this._boneSlotArray.length;d<x;d++)h=this._boneSlotArray[d],h.deformData=null;var P=k[this._aniClipIndex];w=P.default,this._setDeform(w,C,this._boneSlotArray,e);var B;for(B in P)"default"!=B&&B!=this._skinName&&(w=P[B],this._setDeform(w,C,this._boneSlotArray,e));w=P[this._skinName],this._setDeform(w,C,this._boneSlotArray,e)}var U,L,R;if(this._drawOrder)for(d=0,x=this._drawOrder.length;d<x;d++)h=this._boneSlotArray[this._drawOrder[d]],U=D[h.name],L=M[h.name],isNaN(L)||(r.save(),r.alpha(L)),isNaN(U)||U==-2||(this._templet.attachmentNames?h.showDisplayByName(this._templet.attachmentNames[U]):h.showDisplayByIndex(U)),C[this._drawOrder[d]]?(R=C[this._drawOrder[d]],h.currDisplayData&&R[h.currDisplayData.attachmentName]?h.deformData=R[h.currDisplayData.attachmentName]:h.deformData=null):h.deformData=null,isNaN(L)?h.draw(r,this._boneMatrixArray,2==this._aniMode):h.draw(r,this._boneMatrixArray,2==this._aniMode,L),isNaN(L)||r.restore();else for(d=0,x=this._boneSlotArray.length;d<x;d++)h=this._boneSlotArray[d],U=D[h.name],L=M[h.name],isNaN(L)||(r.save(),r.alpha(L)),isNaN(U)||U==-2||(this._templet.attachmentNames?h.showDisplayByName(this._templet.attachmentNames[U]):h.showDisplayByIndex(U)),C[d]?(R=C[d],h.currDisplayData&&R[h.currDisplayData.attachmentName]?h.deformData=R[h.currDisplayData.attachmentName]:h.deformData=null):h.deformData=null,isNaN(L)?h.draw(r,this._boneMatrixArray,2==this._aniMode):h.draw(r,this._boneMatrixArray,2==this._aniMode,L),isNaN(L)||r.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,t,r):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,t,r)},a._setDeform=function(t,i,e,a){if(t){var s,r,n,h=0,l=0,o=0;if(t)for(h=0,l=t.deformSlotDataList.length;h<l;h++)for(s=t.deformSlotDataList[h],o=0;o<s.deformSlotDisplayList.length;o++)r=s.deformSlotDisplayList[o],n=e[r.slotIndex],r.apply(a,n),i[r.slotIndex]||(i[r.slotIndex]={}),i[r.slotIndex][r.attachment]=r.deformData}},a.getAnimNum=function(){return this._templet.getAnimationCount()},a.getAniNameByIndex=function(t){return this._templet.getAniNameByIndex(t)},a.getSlotByName=function(t){return this._boneSlotDic[t]},a.showSkinByName=function(t,i){void 0===i&&(i=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(t),i)},a.showSkinByIndex=function(t,i){void 0===i&&(i=!0);for(var e=0;e<this._boneSlotArray.length;e++)this._boneSlotArray[e].showSlotData(null,i);if(this._templet.showSkinByIndex(this._boneSlotDic,t,i)){var a=this._templet.skinDataArray[t];this._skinIndex=t,this._skinName=a.name}this._clearCache()},a.showSlotSkinByIndex=function(t,i){if(0!=this._aniMode){var e=this.getSlotByName(t);e&&e.showDisplayByIndex(i),this._clearCache()}},a.showSlotSkinByName=function(t,i){if(0!=this._aniMode){var e=this.getSlotByName(t);e&&e.showDisplayByName(i),this._clearCache()}},a.replaceSlotSkinName=function(t,i,e){if(0!=this._aniMode){var a=this.getSlotByName(t);a&&a.replaceDisplayByName(i,e),this._clearCache()}},a.replaceSlotSkinByIndex=function(t,i,e){if(0!=this._aniMode){var a=this.getSlotByName(t);a&&a.replaceDisplayByIndex(i,e),this._clearCache()}},a.setSlotSkin=function(t,i){if(0!=this._aniMode){var e=this.getSlotByName(t);e&&e.replaceSkin(i),this._clearCache()}},a._clearCache=function(){if(1==this._aniMode)for(var t=0,i=this._graphicsCache.length;t<i;t++)this._graphicsCache[t].length=0},a.play=function(t,i,a,s,r,n){void 0===a&&(a=!0),void 0===s&&(s=0),void 0===r&&(r=0),void 0===n&&(n=!0),this._indexControl=!1;var h=-1,o=NaN;if(o=i?2147483647:0,"string"==typeof t)for(var u=0,c=this._templet.getAnimationCount();u<c;u++){var _=this._templet.getAnimation(u);if(_&&t==_.name){h=u;break}}else h=t;h>-1&&h<this.getAnimNum()&&(this._aniClipIndex=h,(a||this._pause||this._currAniIndex!=h)&&(this._currAniIndex=h,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(h)),this._drawOrder=null,this._eventIndex=0,this._player.play(h,this._player.playbackRate,o,s,r),n&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=l.now(),e.stage.frameLoop(1,this,this._update,null,!0)),this._update()))},a.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),e.timer.clear(this,this._update))},a.playbackRate=function(t){this._player&&(this._player.playbackRate=t)},a.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),e.timer.clear(this,this._update))},a.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=l.now(),e.stage.frameLoop(1,this,this._update,null,!0))},a._getGrahicsDataWithCache=function(t,i){return this._graphicsCache[t][i]},a._setGrahicsDataWithCache=function(t,i,e){this._graphicsCache[t][i]=e},a.destroy=function(i){void 0===i&&(i=!0),t.prototype.destroy.call(this,i),this._templet=null,this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,e.timer.clear(this,this._update)},r(0,a,"url",function(){return this._aniPath},function(t){this.load(t)}),r(0,a,"index",function(){return this._index},function(t){this.player&&(this._index=t,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),r(0,a,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),r(0,a,"player",function(){return this._player}),i}(g),G=(function(t){function i(t){this._start=0,this._Pos=0,this._data=null,this._curIndex=0,this._preIndex=0,this._playIndex=0,this._playing=!1,this._ended=!0,this._count=0,this._ids=null,this._loadedImage={},this._idOfSprite=null,this._parentMovieClip=null,this._movieClipList=null,this._labels=null,this.basePath=null,this._atlasPath=null,this._url=null,this._isRoot=!1,this._completeHandler=null,this._endFrame=-1,this.interval=30,this.loop=!1,i.__super.call(this),this._ids={},this._idOfSprite=[],this._reset(),this._playing=!1,this._parentMovieClip=t,t?(this._isRoot=!1,this._movieClipList=t._movieClipList,this._movieClipList.push(this)):(this._movieClipList=[this],this._isRoot=!0)}s(i,"laya.ani.swf.MovieClip",t);var a=i.prototype;a.destroy=function(i){void 0===i&&(i=!0),this._clear(),t.prototype.destroy.call(this,i)},a._setDisplay=function(i){t.prototype._setDisplay.call(this,i),this._isRoot&&this._$3__onDisplay()},a._$3__onDisplay=function(){this._displayedInStage?e.timer.loop(this.interval,this,this.updates,null,!0):e.timer.clear(this,this.updates)},a.updates=function(){if(!this._parentMovieClip){var t=0,i=0;for(i=this._movieClipList.length,t=0;t<i;t++)this._movieClipList[t]&&this._movieClipList[t]._update()}},a.addLabel=function(t,i){this._labels||(this._labels={}),this._labels[i]=t},a.removeLabel=function(t){if(t){if(!this._labels)for(var i in this._labels)if(this._labels[i]===t){delete this._labels[i];break}}else this._labels=null},a._update=function(){if(this._data&&this._playing){if(++this._playIndex>=this._count){if(!this.loop)return this._playIndex--,void this.stop();this._playIndex=0}if(this._parse(this._playIndex),this._labels&&this._labels[this._playIndex]&&this.event("label",this._labels[this._playIndex]),this._endFrame!=-1&&this._endFrame==this._playIndex){if(this._endFrame=-1,null!=this._completeHandler){var t=this._completeHandler;this._completeHandler=null,t.run()}this.stop()}}},a.stop=function(){this._playing=!1},a.gotoAndStop=function(t){this.index=t,this.stop()},a._clear=function(){if(this.stop(),this._idOfSprite.length=0,!this._parentMovieClip){e.timer.clear(this,this.updates);var t=0,i=0;for(i=this._movieClipList.length,t=0;t<i;t++)this._movieClipList[t]!=this&&this._movieClipList[t]._clear();this._movieClipList.length=0}var a;for(a in this._loadedImage)this._loadedImage[a]&&(p.clearRes(a),this._loadedImage[a]=!1);this.removeChildren(),this.graphics=null,this._parentMovieClip=null},a.play=function(t,i){void 0===t&&(t=0),void 0===i&&(i=!0),this.loop=i,this._playing=!0,this._data&&this._displayFrame(t)},a._displayFrame=function(t){void 0===t&&(t=-1),t!=-1&&(this._curIndex>t&&this._reset(),this._parse(t))},a._reset=function(t){void 0===t&&(t=!0),t&&1!=this._curIndex&&this.removeChildren(),this._preIndex=this._curIndex=-1,this._Pos=this._start},a._parse=function(t){var e,a,s,r=0,n=0,h=0,l=!1,o=this._idOfSprite,u=this._data;for(this._ended&&this._reset(),u.pos=this._Pos,this._ended=!1,this._playIndex=t,this._curIndex>t&&t<this._preIndex&&(this._reset(!0),u.pos=this._Pos);this._curIndex<=t&&!this._ended;)switch(u.getUint16()){case 12:if(r=u.getUint16(),n=this._ids[u.getUint16()],this._Pos=u.pos,u.pos=n,0==(h=u.getUint8())){var c=u.getUint16();if(!(a=o[r])){a=o[r]=new g;var _=new g;_.loadImage(this.basePath+c+".png"),this._loadedImage[this.basePath+c+".png"]=!0,a.addChild(_),_.size(u.getFloat32(),u.getFloat32());var p=u._getMatrix();_.transform=p}a.alpha=1}else 1==h&&(e=o[r],e||(o[r]=e=new i(this),e.interval=this.interval,e._ids=this._ids,e.basePath=this.basePath,e._setData(u,n),e._initState(),e.play(0)),e.alpha=1);u.pos=this._Pos;break;case 3:var d=o[u.getUint16()];d&&(this.addChild(d),d.zOrder=u.getUint16(),l=!0);break;case 4:d=o[u.getUint16()],d&&d.removeSelf();break;case 5:o[u.getUint16()][i._ValueList[u.getUint16()]]=u.getFloat32();break;case 6:o[u.getUint16()].visible=u.getUint8()>0;break;case 7:a=o[u.getUint16()];var m=a.transform||f.create();m.setTo(u.getFloat32(),u.getFloat32(),u.getFloat32(),u.getFloat32(),u.getFloat32(),u.getFloat32()),a.transform=m;break;case 8:o[u.getUint16()].setPos(u.getFloat32(),u.getFloat32());break;case 9:o[u.getUint16()].setSize(u.getFloat32(),u.getFloat32());break;case 10:o[u.getUint16()].alpha=u.getFloat32();break;case 11:o[u.getUint16()].setScale(u.getFloat32(),u.getFloat32());break;case 98:s=u.getString(),this.event(s),"stop"==s&&this.stop();break;case 99:this._curIndex=u.getUint16(),l&&this.updateZOrder();break;case 100:this._count=this._curIndex+1,this._ended=!0,this._playing&&(this.event("enterframe"),this.event("end"),this.event("complete")),this._reset(!1)}this._playing&&!this._ended&&this.event("enterframe"),this._Pos=u.pos},a._setData=function(t,i){this._data=t,this._start=i+3},a.load=function(t,i,a){void 0===i&&(i=!1),this._url=t=M.formatURL(t),i&&(this._atlasPath=a?a:t.split(".swf")[0]+".json"),this.stop(),this._clear(),this._movieClipList=[this];var s;s=[{url:t,type:"arraybuffer"}],this._atlasPath&&s.push({url:this._atlasPath,type:"atlas"}),e.loader.load(s,_.create(this,this._onLoaded))},a._onLoaded=function(){var t;if(!(t=p.getRes(this._url)))return void this.event("error","file not find");this.basePath=this._atlasPath?p.getAtlas(this._atlasPath).dir:this._url.split(".swf")[0]+"/image/",this._initData(t)},a._initState=function(){this._reset(),this._ended=!1;var t=this._playing;for(this._playing=!1,this._curIndex=0;!this._ended;)this._parse(++this._curIndex);this._playing=t},a._initData=function(t){this._data=new o(t);var i=0,a=this._data.getUint16();for(i=0;i<a;i++)this._ids[this._data.getInt16()]=this._data.getInt32();this.interval=1e3/this._data.getUint16(),this._setData(this._data,this._ids[32767]),this._initState(),this.play(0),this.event("loaded"),this._parentMovieClip||e.timer.loop(this.interval,this,this.updates,null,!0)},a.playTo=function(t,i,e){this._completeHandler=e,this._endFrame=i,this.play(t,!1)},r(0,a,"index",function(){return this._playIndex},function(t){this._playIndex=t,this._data&&this._displayFrame(this._playIndex),this._labels&&this._labels[t]&&this.event("label",this._labels[t])}),r(0,a,"count",function(){return this._count}),r(0,a,"playing",function(){return this._playing}),r(0,a,"url",null,function(t){this.load(t)}),i._ValueList=["x","y","width","height","scaleX","scaleY","rotation","alpha"],i}(g),function(t){function i(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._rate=30,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,i.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}s(i,"laya.ani.bone.Templet",t);var a=i.prototype;return a.loadAni=function(t){this._skBufferUrl=t,e.loader.load(t,_.create(this,this.onComplete),null,"arraybuffer")},a.onComplete=function(t){var i=p.getRes(this._skBufferUrl);this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,i)},a.parseData=function(t,i,e){void 0===e&&(e=30),this._mainTexture=t,this._mainTexture&&m.isWebGL&&t.bitmap&&(t.bitmap.enableMerageInAtlas=!1),this._rate=e,this.parse(i)},a.buildArmature=function(t){return void 0===t&&(t=0),new q(this,t)},a.parse=function(i){t.prototype.parse.call(this,i),this._endLoaded(),this._aniVersion!=z.LAYA_ANIMATION_VISION&&(console.log("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+z.LAYA_ANIMATION_VISION),this._loaded=!1),this._loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},a._parseTexturePath=function(){var t=0;this._loadList=[];var i,a=new o(this.getPublicExtData()),s=0,r=0,n=0,h=a.getInt32(),l=a.readUTFString(),u=l.split("\n");for(t=0;t<h;t++)i=this._path+u[2*t],l=u[2*t+1],a.getFloat32(),a.getFloat32(),s=a.getFloat32(),r=a.getFloat32(),n=a.getFloat32(),isNaN(n)?0:n,n=a.getFloat32(),isNaN(n)?0:n,n=a.getFloat32(),isNaN(n)?s:n,n=a.getFloat32(),isNaN(n)?r:n,this._loadList.indexOf(i)==-1&&this._loadList.push(i);e.loader.load(this._loadList,_.create(this,this._textureComplete))},a._textureComplete=function(){
for(var t,i,e=0,a=this._loadList.length;e<a;e++)i=this._loadList[e],t=this._textureDic[i]=p.getRes(i),m.isWebGL&&t&&t.bitmap&&(t.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},a._parsePublicExtData=function(){var t=0,i=0,e=0,a=0,s=0;for(t=0,s=this.getAnimationCount();t<s;t++)this._graphicsCache.push([]);var r=!1;r="Dragon"!=this.aniClassName;var n,h,l=new o(this.getPublicExtData()),u=0,c=0,_=0,p=0,d=0,m=0,y=0,x=0,g=0,v=l.getInt32(),M=l.readUTFString(),I=M.split("\n");for(t=0;t<v;t++)n=this._mainTexture,h=this._path+I[2*t],M=I[2*t+1],null==this._mainTexture&&(n=this._textureDic[h]),u=l.getFloat32(),c=l.getFloat32(),_=l.getFloat32(),p=l.getFloat32(),g=l.getFloat32(),d=isNaN(g)?0:g,g=l.getFloat32(),m=isNaN(g)?0:g,g=l.getFloat32(),y=isNaN(g)?_:g,g=l.getFloat32(),x=isNaN(g)?p:g,this.subTextureDic[M]=D.create(n,u,c,_,p,-d,-m,y,x);this._mainTexture=n;var C,P=l.getUint16();for(t=0;t<P;t++)C=[],C.push(l.getUint16()),C.push(l.getUint16()),C.push(l.getUint16()),C.push(l.getUint16()),this.aniSectionDic[t]=C;var O,V,X,K,W,z=l.getInt16(),q={};for(t=0;t<z;t++)O=new b,0==t?W=O:O.root=W,O.d=r?-1:1,X=l.readUTFString(),K=l.readUTFString(),O.length=l.getFloat32(),1==l.getByte()&&(O.inheritRotation=!1),1==l.getByte()&&(O.inheritScale=!1),O.name=X,K&&(V=q[K],V?V.addChild(O):this.mRootBone=O),q[X]=O,this.mBoneArr.push(O);this.tMatrixDataLen=l.getUint16();var G,H=l.getUint16(),Q=Math.floor(H/this.tMatrixDataLen),Z=this.srcBoneMatrixArr;for(t=0;t<Q;t++)G=new Y,G.scX=l.getFloat32(),G.skX=l.getFloat32(),G.skY=l.getFloat32(),G.scY=l.getFloat32(),G.x=l.getFloat32(),G.y=l.getFloat32(),8===this.tMatrixDataLen&&(G.skewX=l.getFloat32(),G.skewY=l.getFloat32()),Z.push(G),O=this.mBoneArr[t],O.transform=G;var $,j=l.getUint16(),J=0;for(t=0;t<j;t++){for($=new k,J=l.getUint16(),i=0;i<J;i++)$.boneNames.push(l.readUTFString()),$.boneIndexs.push(l.getInt16());$.name=l.readUTFString(),$.targetBoneName=l.readUTFString(),$.targetBoneIndex=l.getInt16(),$.bendDirection=l.getFloat32(),$.mix=l.getFloat32(),$.isSpine=r,this.ikArr.push($)}var tt,it=l.getUint16(),et=0;for(t=0;t<it;t++){for(tt=new E,et=l.getUint16(),i=0;i<et;i++)tt.boneIndexs.push(l.getInt16());tt.name=l.getUTFString(),tt.targetIndex=l.getInt16(),tt.rotateMix=l.getFloat32(),tt.translateMix=l.getFloat32(),tt.scaleMix=l.getFloat32(),tt.shearMix=l.getFloat32(),tt.offsetRotation=l.getFloat32(),tt.offsetX=l.getFloat32(),tt.offsetY=l.getFloat32(),tt.offsetScaleX=l.getFloat32(),tt.offsetScaleY=l.getFloat32(),tt.offsetShearY=l.getFloat32(),this.tfArr.push(tt)}var at,st=l.getUint16(),rt=0;for(t=0;t<st;t++){for(at=new B,at.name=l.readUTFString(),rt=l.getUint16(),i=0;i<rt;i++)at.bones.push(l.getInt16());at.target=l.readUTFString(),at.positionMode=l.readUTFString(),at.spacingMode=l.readUTFString(),at.rotateMode=l.readUTFString(),at.offsetRotation=l.getFloat32(),at.position=l.getFloat32(),at.spacing=l.getFloat32(),at.rotateMix=l.getFloat32(),at.translateMix=l.getFloat32(),this.pathArr.push(at)}var nt,ht,lt,ot,ut=0,ct=0,_t=0,pt=NaN,dt=0,ft=l.getInt16();for(t=0;t<ft;t++){var mt=l.getUint8(),yt={};this.deformAniArr.push(yt);for(var xt=0;xt<mt;xt++)for(nt=new A,nt.skinName=l.getUTFString(),yt[nt.skinName]=nt,ut=l.getInt16(),i=0;i<ut;i++)for(ht=new T,nt.deformSlotDataList.push(ht),ct=l.getInt16(),e=0;e<ct;e++)for(lt=new S,ht.deformSlotDisplayList.push(lt),lt.slotIndex=l.getInt16(),lt.attachment=l.getUTFString(),_t=l.getInt16(),a=0;a<_t;a++)for(1==l.getByte()?lt.tweenKeyList.push(!0):lt.tweenKeyList.push(!1),pt=l.getFloat32(),lt.timeList.push(pt),ot=[],lt.vectices.push(ot),dt=l.getInt16(),s=0;s<dt;s++)ot.push(l.getFloat32())}var gt,vt,Dt=l.getInt16(),Mt=0,It=0;for(t=0;t<Dt;t++){for(Mt=l.getInt16(),gt=[],i=0;i<Mt;i++){for(vt=new F,vt.time=l.getFloat32(),It=l.getInt16(),e=0;e<It;e++)vt.drawOrder.push(l.getInt16());gt.push(vt)}this.drawOrderAniArr.push(gt)}var bt,Nt,At=l.getInt16(),Tt=0;for(t=0;t<At;t++){for(Tt=l.getInt16(),bt=[],i=0;i<Tt;i++)Nt=new w,Nt.name=l.getUTFString(),Nt.intValue=l.getInt32(),Nt.floatValue=l.getFloat32(),Nt.stringValue=l.getUTFString(),Nt.time=l.getFloat32(),bt.push(Nt);this.eventAniArr.push(bt)}var St=l.getInt16();if(St>0)for(this.attachmentNames=[],t=0;t<St;t++)this.attachmentNames.push(l.getUTFString());var Ft,wt,Ct=l.getInt16();for(t=0;t<Ct;t++)Ft=new N,Ft.name=l.readUTFString(),Ft.parent=l.readUTFString(),Ft.attachmentName=l.readUTFString(),Ft.srcDisplayIndex=Ft.displayIndex=l.getInt16(),Ft.templet=this,this.boneSlotDic[Ft.name]=Ft,wt=this.bindBoneBoneSlotDic[Ft.parent],null==wt&&(this.bindBoneBoneSlotDic[Ft.parent]=wt=[]),wt.push(Ft),this.boneSlotArray.push(Ft);var kt,Pt,Bt,Ut=l.readUTFString(),Lt=Ut.split("\n"),Rt=0,Ot=l.getUint8(),Et=0,Yt=0,Vt=0,Xt=0,Kt=0,Wt=0,zt=0;for(t=0;t<Ot;t++){for(kt=new U,kt.name=Lt[Rt++],Et=l.getUint8(),i=0;i<Et;i++){for(Pt=new R,Pt.name=Lt[Rt++],Ft=this.boneSlotDic[Pt.name],Yt=l.getUint8(),e=0;e<Yt;e++){if(Bt=new L,this.skinSlotDisplayDataArr.push(Bt),Bt.name=Lt[Rt++],Bt.attachmentName=Lt[Rt++],Bt.transform=new Y,Bt.transform.scX=l.getFloat32(),Bt.transform.skX=l.getFloat32(),Bt.transform.skY=l.getFloat32(),Bt.transform.scY=l.getFloat32(),Bt.transform.x=l.getFloat32(),Bt.transform.y=l.getFloat32(),Pt.displayArr.push(Bt),Bt.width=l.getFloat32(),Bt.height=l.getFloat32(),Bt.type=l.getUint8(),Bt.verLen=l.getUint16(),(z=l.getUint16())>0)for(Bt.bones=[],a=0;a<z;a++){var qt=l.getUint16();Bt.bones.push(qt)}if((Vt=l.getUint16())>0)for(Bt.uvs=[],a=0;a<Vt;a++)Bt.uvs.push(l.getFloat32());if((Xt=l.getUint16())>0)for(Bt.weights=[],a=0;a<Xt;a++)Bt.weights.push(l.getFloat32());if((Kt=l.getUint16())>0)for(Bt.triangles=[],a=0;a<Kt;a++)Bt.triangles.push(l.getUint16());if((Wt=l.getUint16())>0)for(Bt.vertices=[],a=0;a<Wt;a++)Bt.vertices.push(l.getFloat32());if((zt=l.getUint16())>0)for(Bt.lengths=[],a=0;a<zt;a++)Bt.lengths.push(l.getFloat32())}kt.slotArr.push(Pt)}this.skinDic[kt.name]=kt,this.skinDataArray.push(kt)}1==l.getUint8()?(this.yReverseMatrix=new f(1,0,0,-1,0,0),W&&W.setTempMatrix(this.yReverseMatrix)):W&&W.setTempMatrix(new f),this.showSkinByIndex(this.boneSlotDic,0),this.event("complete",this)},a.getTexture=function(t){var i=this.subTextureDic[t];return null==i?this._mainTexture:i},a.showSkinByIndex=function(t,i,e){if(void 0===e&&(e=!0),i<0&&i>=this.skinDataArray.length)return!1;var a,s,r=0,n=0,h=this.skinDataArray[i];if(h){for(r=0,n=h.slotArr.length;r<n;r++)(s=h.slotArr[r])&&(a=t[s.name])&&(a.showSlotData(s,e),e&&"undefined"!=a.attachmentName&&"null"!=a.attachmentName?a.showDisplayByName(a.attachmentName):a.showDisplayByIndex(a.displayIndex));return!0}return!1},a.getSkinIndexByName=function(t){for(var i,e=0,a=this.skinDataArray.length;e<a;e++)if(i=this.skinDataArray[e],i.name==t)return e;return-1},a.getGrahicsDataWithCache=function(t,i){return this._graphicsCache[t][i]},a.setGrahicsDataWithCache=function(t,i,e){this._graphicsCache[t][i]=e},a.destroy=function(){var t;for(var e in this.subTextureDic)t=this.subTextureDic[e],t.destroy();var e;for(e in this._textureDic)t=this._textureDic[e],t.destroy();for(var a,s=0,r=this.skinSlotDisplayDataArr.length;s<r;s++)a=this.skinSlotDisplayDataArr[s],a.destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete i.TEMPLET_DICTIONARY[this.url],this.dispose()},a.getAniNameByIndex=function(t){var i=this.getAnimation(t);return i?i.name:null},r(0,a,"rate",function(){return this._rate}),i.TEMPLET_DICTIONARY=null,i}(z))}(window,document,Laya);