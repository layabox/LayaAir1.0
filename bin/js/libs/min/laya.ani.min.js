!function(t,i,e){var a=(e.un,e.uns,e["static"],e["class"]),n=e.getset,s=e.__newvec,r=laya.net.URL,h=laya.maths.Matrix,l=laya.display.Graphics,o=laya.utils.Handler,u=(laya.events.Event,laya.net.Loader),_=laya.resource.Texture,p=laya.utils.Byte,c=laya.events.EventDispatcher,d=laya.maths.MathUtil,f=laya.utils.Stat,m=laya.display.Sprite,y=laya.utils.Browser,g=(function(){function t(){}return a(t,"laya.ani.AnimationState"),t.stopped=0,t.paused=1,t.playing=2,t}(),function(){function t(){this.name=null,this.parent=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null}a(t,"laya.ani.bone.BoneSlot");var i=t.prototype;return i.showSlotData=function(t){this.currSlotData=t,this.displayIndex=this.srcDisplayIndex,this.currDisplayData=null,this.currTexture=null},i.showDisplayByIndex=function(t){this.currSlotData&&t>-1&&t<this.currSlotData.displayArr.length?(this.displayIndex=t,this.currDisplayData=this.currSlotData.displayArr[t],this.currDisplayData&&(this.currTexture=this.templet.getTexture(this.currDisplayData.name))):(this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null)},i.replaceSkin=function(t){this._diyTexture=t},i.setParentMatrix=function(t){this._parentMatrix=t},i.draw=function(t,i){if(void 0===i&&(i=!1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData){var e=this.currTexture;if(this._diyTexture&&(e=this._diyTexture),t){var a=this.getDisplayMatrix();if(this._parentMatrix&&a){h.mul(a,this._parentMatrix,h.TEMP);var n;i?(null==this._resultMatrix&&(this._resultMatrix=new h),n=this._resultMatrix):n=new h,h.TEMP.copy(n),t.drawTexture(e,-e.sourceWidth/2,-e.sourceHeight/2,e.sourceWidth,e.sourceHeight,n)}}}},i.drawBonePoint=function(t){t&&this._parentMatrix&&t.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},i.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},i.copy=function(){var i=new t;return i.type="copy",i.name=this.name,i.srcDisplayIndex=this.srcDisplayIndex,i.parent=this.parent,i.displayIndex=this.displayIndex,i.templet=this.templet,i.currSlotData=this.currSlotData,i.currTexture=this.currTexture,i.currDisplayData=this.currDisplayData,i},t}()),x=function(){function t(){this.name=null,this.slotArr=[]}a(t,"laya.ani.bone.SkinData");var i=t.prototype;return i.initData=function(t){this.name=t.name;for(var i,e,a=t.slot,n=0;n<a.length;n++)e=a[n],i=new I,i.initData(e),this.slotArr.push(i)},t}(),v=function(){function t(){this.name=null,this.type=null,this.transform=null}a(t,"laya.ani.bone.SkinSlotDisplayData");var i=t.prototype;return i.initData=function(t){this.name=t.name,this.type=t.type,this.transform=new D,this.transform.initData(t.transform)},t}(),I=function(){function t(){this.name=null,this.displayArr=[]}a(t,"laya.ani.bone.SlotData");var i=t.prototype;return i.initData=function(t){this.name=t.name;for(var i,e,a=t.display,n=0;n<a.length;n++)e=a[n],i=new v,i.initData(e),this.displayArr.push(i)},t}(),D=function(){function t(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.mMatrix=null}a(t,"laya.ani.bone.Transform");var i=t.prototype;return i.initData=function(t){void 0!=t.x&&(this.x=t.x),void 0!=t.y&&(this.y=t.y),void 0!=t.skX&&(this.skX=t.skX),void 0!=t.skY&&(this.skY=t.skY),void 0!=t.scX&&(this.scX=t.scX),void 0!=t.scY&&(this.scY=t.scY)},i.getMatrix=function(){var t;if(t=this.mMatrix?this.mMatrix:this.mMatrix=new h,t.a=Math.cos(this.skY),0!=this.skX||0!=this.skY){var i=this.skX*Math.PI/180,e=Math.cos(i),a=Math.sin(i);t.setTo(this.scX*e,this.scX*a,this.scY*-a,this.scY*e,this.x,this.y)}else t.setTo(this.scX,this.skX,this.skY,this.scY,this.x,this.y);return t},t}(),A=function(t){function i(t){this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._duration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startPlayLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this.playbackRate=1,this.isCache=!0,this.returnToZeroStopped=!0,i.__super.call(this),void 0===t&&(t=60),this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._duration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startPlayLoopCount=-1,this._cacheFrameRate=t,this._cacheFrameRateInterval=1e3/this._cacheFrameRate}a(i,"laya.ani.AnimationPlayer",t);var e=i.prototype;return e.play=function(t,i,e){void 0===t&&(t=0),void 0===i&&(i=1),void 0===e&&(e=Number.MAX_VALUE),this._currentTime=0,this._elapsedPlaybackTime=0,this.playbackRate=i,this._duration=e,this._paused=!1,this._currentAnimationClipIndex=t,this._currentKeyframeIndex=0,this._startPlayLoopCount=f.loopCount,this.event("played")},e.stop=function(t){void 0===t&&(t=!0),t?(this._currentAnimationClipIndex=this._currentKeyframeIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},e.update=function(t){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var i=0;this._startPlayLoopCount!==f.loopCount&&(i=t*this.playbackRate,this._elapsedPlaybackTime+=i);var e=this._templet.getAniDuration(this._currentAnimationClipIndex);if(0!==this._duration&&this._elapsedPlaybackTime>=this._duration||0===this._duration&&this._elapsedPlaybackTime>=e)return this._currentAnimationClipIndex=this._currentKeyframeIndex=-1,void this.event("stopped");for(i+=this._currentTime;i>=e;){if(this._stopWhenCircleFinish)return this._currentAnimationClipIndex=this._currentKeyframeIndex=-1,this._stopWhenCircleFinish=!1,void this.event("stopped");i-=e}this.currentTime=i}},n(0,e,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),n(0,e,"templet",function(){return this._templet},function(t){0===!this.State&&this.stop(!0),this._templet=t}),n(0,e,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),n(0,e,"cacheFrameRate",function(){return this._cacheFrameRate}),n(0,e,"currentFrameTime",function(){return this._currentFrameTime}),n(0,e,"currentTime",function(){return this._currentTime},function(t){this._currentTime=t,this._currentKeyframeIndex=Math.floor(this._currentTime%this._templet.getAniDuration(this._currentAnimationClipIndex)/this._cacheFrameRateInterval),this._currentFrameTime=this._currentKeyframeIndex*this._cacheFrameRateInterval}),n(0,e,"State",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),n(0,e,"paused",function(){return this._paused},function(t){this._paused=t,t&&this.event("paused")}),i}(c),C=function(t){function i(){this._aniMap={},this.unfixedLastAniIndex=-1,this._loaded=!1,this._animationDatasCache=[],i.__super.call(this),this._anis=new Array}a(i,"laya.ani.KeyframesAniTemplet",t);var e=i.prototype;return e.parse=function(t,e){var a=0,n=0,s=0,r=0,h=0,l=new p(t),o=l.readUTFString();if(o!=laya.ani.KeyframesAniTemplet.LAYA_ANIMATION_VISION)return void console.log("[Error] Version "+o+" The engine is inconsistent, update to the version "+laya.ani.KeyframesAniTemplet.LAYA_ANIMATION_VISION+" please.");var u,_=(l.readUTFString(),l.readUTFString().split("\n")),c=l.getUint8(),d=l.getUint32(),f=l.getUint32();d>0&&(u=t.slice(d,f));var m=new p(u);for(f>0&&(this._publicExtData=t.slice(f,t.byteLength)),this._useParent=!!l.getUint8(),this._anis.length=c,a=0;c>a;a++){var y=this._anis[a]={};y.nodes=new Array;var g=y.name=_[l.getUint16()];this._aniMap[g]=a,y.bone3DMap={},y.playTime=l.getFloat32();var x=y.nodes.length=l.getUint8();for(y.totalKeyframesLength=0,n=0;x>n;n++){var v=y.nodes[n]={};v.childs=[];var I=l.getInt16();I>=0&&(v.name=_[I],y.bone3DMap[v.name]=n),v.keyFrame=new Array,v.parentIndex=l.getInt16(),v.parent=y.nodes[v.parentIndex];var D=!!l.getUint8(),A=l.getUint32();m.pos=A;var C=v.keyframeWidth=m.getUint16();if(y.totalKeyframesLength+=C,D)for(v.interpolationMethod=[],v.interpolationMethod.length=C,s=0;C>s;s++)v.interpolationMethod[s]=i.interpolation[m.getUint8()];null!=v.parent&&v.parent.childs.push(v);var b=l.getUint16();b>0&&(v.extenData=t.slice(l.pos,l.pos+b),l.pos+=b);var T=l.getUint16();v.keyFrame.length=T;var F=0;for(s=0,r=T;r>s;s++){var S=v.keyFrame[s]={};for(S.duration=l.getFloat32(),S.startTime=F,S.data=new Float32Array(C),S.dData=new Float32Array(C),S.nextData=new Float32Array(C),h=0;C>h;h++)S.data[h]=l.getFloat32(),S.data[h]>-1e-8&&S.data[h]<1e-8&&(S.data[h]=0);F+=S.duration}v.playTime=F,this._calculateKeyFrame(v,T,C),this._calculateKeyFrameIndex(v,e)}}this._loaded=!0,this.event("loaded",this)},e._calculateKeyFrame=function(t,i,e){var a=t.keyFrame;a[i]=a[0];for(var n=0;i>n;n++)for(var s=a[n],r=0;e>r;r++)s.dData[r]=0===s.duration?0:(a[n+1].data[r]-s.data[r])/s.duration,s.nextData[r]=a[n+1].data[r];a.length--},e._calculateKeyFrameIndex=function(t,i){var e=1e3/i;t.frameCount=Math.floor(t.playTime/e),t.fullFrame=new Uint16Array(t.frameCount+1);for(var a=-1,n=0,s=t.keyFrame.length;s>n;n++){var r=t.keyFrame[n],h=r.startTime,l=h+r.duration+e;do{for(var o=Math.floor(h/e+.5),u=a+1;o>u;u++)t.fullFrame[u]=n;a=o,t.fullFrame[o]=n,h+=e}while(l>=h)}},e.getAnimationCount=function(){return this._anis.length},e.getAnimation=function(t){return this._anis[t]},e.getAniDuration=function(t){return this._anis[t].playTime},e.getNodes=function(t){return this._anis[t].nodes},e.getNodeIndexWithName=function(t,i){return this._anis[t].bone3DMap[i]},e.getNodeCount=function(t){return this._anis[t].nodes.length},e.getTotalkeyframesLength=function(t){return this._anis[t].totalKeyframesLength},e.getPublicExtData=function(){return this._publicExtData},e.getAnimationDataWithCache=function(t,i,e){var a=t[i];return a?a[e]:null},e.setAnimationDataWithCache=function(t,i,e,a){var n=t[i];n||(n=t[i]=[],n.length=30),n[e]||(n[e]=new Float32Array(a.length)),n[e].set(a,0)},e.getOriginalData=function(t,i,e,a){for(var n=this._anis[t],s=n.nodes,r=0,h=0,l=s.length,o=0;l>h;h++){var u,_=s[h];u=_.keyFrame[_.fullFrame[e]],_.dataOffset=o;var p=a-u.startTime;for(r=0;r<_.keyframeWidth;)r+=_.interpolationMethod[r](_,r,i,o+r,u.data,p,u.dData,u.duration,u.nextData);o+=_.keyframeWidth}},e.getNodesCurrentFrameIndex=function(t,i){var e=this._anis[t],a=e.nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(a.length),this.unfixedCurrentTimes=new Float32Array(a.length),this.unfixedLastAniIndex=t);for(var n=0,s=a.length;s>n;n++){var r=a[n];for(i<this.unfixedCurrentTimes[n]&&(this.unfixedCurrentFrameIndexes[n]=0),this.unfixedCurrentTimes[n]=i;this.unfixedCurrentFrameIndexes[n]<r.keyFrame.length&&!(r.keyFrame[this.unfixedCurrentFrameIndexes[n]].startTime>this.unfixedCurrentTimes[n]);)this.unfixedCurrentFrameIndexes[n]++;this.unfixedCurrentFrameIndexes[n]--}return this.unfixedCurrentFrameIndexes},e.getOriginalDataUnfixedRate=function(t,i,e){var a=this._anis[t],n=a.nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(n.length),this.unfixedCurrentTimes=new Float32Array(n.length),this.unfixedKeyframes=s(n.length),this.unfixedLastAniIndex=t);for(var r=0,h=0,l=n.length,o=0;l>h;h++){var u=n[h];for(e<this.unfixedCurrentTimes[h]&&(this.unfixedCurrentFrameIndexes[h]=0),this.unfixedCurrentTimes[h]=e;this.unfixedCurrentFrameIndexes[h]<u.keyFrame.length&&!(u.keyFrame[this.unfixedCurrentFrameIndexes[h]].startTime>this.unfixedCurrentTimes[h]);)this.unfixedKeyframes[h]=u.keyFrame[this.unfixedCurrentFrameIndexes[h]],this.unfixedCurrentFrameIndexes[h]++;var _=this.unfixedKeyframes[h];u.dataOffset=o;var p=e-_.startTime;for(r=0;r<u.keyframeWidth;)r+=u.interpolationMethod[r](u,r,i,o+r,_.data,p,_.dData,_.duration,_.nextData);o+=u.keyframeWidth}},n(0,e,"loaded",function(){return this._loaded}),i._LinearInterpolation_0=function(t,i,e,a,n,s,r,h,l){return e[a]=n[i]+s*r[i],1},i._QuaternionInterpolation_1=function(t,i,e,a,n,s,r,h,l){return d.slerpQuaternionArray(n,i,l,i,s/h,e,a),4},i._AngleInterpolation_2=function(t,i,e,a,n,s,r,h,l){return 0},i._RadiansInterpolation_3=function(t,i,e,a,n,s,r,h,l){return 0},i._Matrix4x4Interpolation_4=function(t,i,e,a,n,s,r,h,l){for(var o=0;16>o;o++,i++)e[a+o]=n[i]+s*r[i];return 16},i._NoInterpolation_5=function(t,i,e,a,n,s,r,h,l){return e[a]=n[i],1},i.interpolation=[i._LinearInterpolation_0,i._QuaternionInterpolation_1,i._AngleInterpolation_2,i._RadiansInterpolation_3,i._Matrix4x4Interpolation_4,i._NoInterpolation_5],i.LAYA_ANIMATION_VISION="LAYAANIMATION:1.0.0",i}(c),b=function(t){function i(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.url=null,this._rate=60,i.__super.call(this)}a(i,"laya.ani.bone.Templet",t);var e=i.prototype;return e.parseData=function(t,i,e){void 0===e&&(e=60),this._mainTexture=t,this._rate=e,this.parse(i,e)},e.buildArmature=function(t){return void 0===t&&(t=0),new T(this,t)},e.parse=function(i,e){t.prototype.parse.call(this,i,e),this._loaded?(this._parsePublicExtData(),this.event("complete",this)):(this.event("error",this),this.isParseFail=!0)},e._parsePublicExtData=function(){var t=0,i=0,e=0,a=0;for(t=0,a=this.getAnimationCount();a>t;t++)this._graphicsCache.push([]);var n=new p(this.getPublicExtData()),s=0,r=0,h=0,l=0,o=0,u=0,c=0,d=0,f=0,m=n.getUint8(),y=n.readUTFString(),A=y.split("\n");for(t=0;m>t;t++)y=A[t],s=n.getFloat32(),r=n.getFloat32(),h=n.getFloat32(),l=n.getFloat32(),f=n.getFloat32(),o=isNaN(f)?0:f,f=n.getFloat32(),u=isNaN(f)?0:f,f=n.getFloat32(),c=isNaN(f)?h:f,f=n.getFloat32(),d=isNaN(f)?l:f,this.subTextureDic[y]=_.create(this._mainTexture,s,r,h,l,-o,-u,c,d);var C=n.getUint16(),b=n.getUint16(),T=Math.floor(b/C),F=this.srcBoneMatrixArr;for(t=0;T>t;t++){var S=new D;S.scX=n.getFloat32(),S.skX=n.getFloat32(),S.skY=n.getFloat32(),S.scY=n.getFloat32(),S.x=n.getFloat32(),S.y=n.getFloat32(),F.push(S)}var M,k,w=n.getInt16();for(t=0;w>t;t++)M=new g,M.name=n.readUTFString(),M.parent=n.readUTFString(),M.srcDisplayIndex=M.displayIndex=n.getInt16(),M.templet=this,this.boneSlotDic[M.name]=M,k=this.bindBoneBoneSlotDic[M.parent],null==k&&(this.bindBoneBoneSlotDic[M.parent]=k=[]),k.push(M),this.boneSlotArray.push(M);for(t=0;t<this.boneSlotArray.length;t++)M=this.boneSlotArray[t];var N=n.readUTFString(),P=N.split("\n"),L=0,U=n.getUint8();for(t=0;U>t;t++){var B=new x;B.name=P[L++];var O=n.getUint8();for(i=0;O>i;i++){var Y=new I;Y.name=P[L++],M=this.boneSlotDic[Y.name];var E=n.getUint8();for(e=0;E>e;e++){var R=new v;R.name=P[L++],R.transform=new D,R.transform.scX=n.getFloat32(),R.transform.skX=n.getFloat32(),R.transform.skY=n.getFloat32(),R.transform.scY=n.getFloat32(),R.transform.x=n.getFloat32(),R.transform.y=n.getFloat32(),Y.displayArr.push(R)}B.slotArr.push(Y)}this.skinDic[B.name]=B,this.skinDataArray.push(B)}this.showSkinByIndex(this.boneSlotDic,0)},e.getTexture=function(t){return this.subTextureDic[t]},e.showSkinByIndex=function(t,i){if(!(0>i&&i>=this.skinDataArray.length)){var e,a,n=0,s=0,r=this.skinDataArray[i];if(r)for(n=0,s=r.slotArr.length;s>n;n++)a=r.slotArr[n],a&&(e=t[a.name],e&&(e.showSlotData(a),e.showDisplayByIndex(e.displayIndex)))}},e.showSkinByName=function(t,i){var e,a,n=0,s=0,r=this.skinDic[i];if(r)for(n=0,s=r.slotArr.length;s>n;n++)a=r.slotArr[n],a&&(e=t[a.name],e&&(e.showSlotData(a),e.showDisplayByIndex(e.displayIndex)))},e.getGrahicsDataWithCache=function(t,i){return this._graphicsCache[t][i]},e.setGrahicsDataWithCache=function(t,i,e){this._graphicsCache[t][i]=e},e.destory=function(){this.url&&delete i.TEMPLET_DICTIONARY[this.url]},e.getAniNameByIndex=function(t){var i=this.getAnimation(t);return i?i.name:null},n(0,e,"rate",function(){return this._rate}),i.TEMPLET_DICTIONARY=null,i}(C),T=function(t){function i(t,e){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,i.__super.call(this),this._tempTransform=new D,void 0===e&&(e=0),t&&this.init(t,e)}a(i,"laya.ani.bone.Skeleton",t);var s=i.prototype;return s.init=function(t,i){if(void 0===i&&(i=0),1==i){this._graphicsCache=[];for(var e=0,a=t.getAnimationCount();a>e;e++)this._graphicsCache.push([])}this._aniMode=i,this._templet=t,this._player=new A(t.rate),this._player.templet=t,this._player.play(),this._parseSrcBoneMatrix(),this._player.on("played",this,this.onPlay),this._player.on("stopped",this,this.onStop),this._player.on("paused",this,this.onPause)},s.load=function(t,i,a){void 0===a&&(a=0),this._aniPath=t,this._complete=i,this._loadAniMode=a,this._texturePath=t.replace(".sk",".png").replace(".bin",".png"),e.loader.load([{url:t,type:"arraybuffer"},{url:this._texturePath,type:"image"}],o.create(this,this.onLoaded))},s.onLoaded=function(){var t=u.getRes(this._texturePath),i=u.getRes(this._aniPath);if(null!=t&&null!=i){null==b.TEMPLET_DICTIONARY&&(b.TEMPLET_DICTIONARY={});var e;e=b.TEMPLET_DICTIONARY[this._aniPath],e?e.isParseFail?this.parseFail():this.parseComplete():(e=new b,e.url=this._aniPath,b.TEMPLET_DICTIONARY[this._aniPath]=e,e.on("complete",this,this.parseComplete),e.on("error",this,this.parseFail),e.parseData(t,i,60))}},s.parseComplete=function(){var t=b.TEMPLET_DICTIONARY[this._aniPath];t&&(this.init(t,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},s.parseFail=function(){console.log("[Error]:"+this._aniPath+"解析失败")},s.onPlay=function(){this.event("played")},s.onStop=function(){this.event("stopped")},s.onPause=function(){this.event("paused")},s._parseSrcBoneMatrix=function(){var t=0,i=0;for(i=this._templet.srcBoneMatrixArr.length,t=0;i>t;t++)this._boneMatrixArray.push(new h);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var e,a,n=this._templet.boneSlotArray;for(t=0,i=n.length;i>t;t++)e=n[t],a=this._bindBoneBoneSlotDic[e.parent],null==a&&(this._bindBoneBoneSlotDic[e.parent]=a=[]),this._boneSlotDic[e.name]=e=e.copy(),a.push(e),this._boneSlotArray.push(e)}},s._update=function(){if(!this._pause){var t=e.stage.now;if(this._player.update(t-this._lastTime),this._lastTime=t,this._aniClipIndex=this._player.currentAnimationClipIndex,this._clipIndex=this._player.currentKeyframeIndex,-1!=this._aniClipIndex){var i;if(0==this._aniMode){if(i=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics=i)}else if(1==this._aniMode&&(i=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex)))return void(this.graphics=i);this._createGraphics()}}},s._createGraphics=function(){var t=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._clipIndex,this._player.currentFrameTime);var i,e,a,n,s,r,o=0,u=0,_=0,p=0,c=this._templet.srcBoneMatrixArr.length;for(u=0;c>u;u++){e=this._boneMatrixArray[u],r=this._templet.srcBoneMatrixArr[u],this._tempTransform.scX=r.scX*this._curOriginalData[o++],this._tempTransform.skX=r.skX+this._curOriginalData[o++],this._tempTransform.skY=r.skY+this._curOriginalData[o++],this._tempTransform.scY=r.scY*this._curOriginalData[o++],this._tempTransform.x=r.x+this._curOriginalData[o++],this._tempTransform.y=r.y+this._curOriginalData[o++],s=this._tempTransform.getMatrix();var d=t[u];if(-1!=d.parentIndex?(i=this._boneMatrixArray[d.parentIndex],h.mul(s,i,e)):s.copy(e),n=this._bindBoneBoneSlotDic[d.name])for(_=0,p=n.length;p>_;_++)a=n[_],a&&a.setParentMatrix(e)}for(var f={},m={};u<t.length;u++){var y=t[u];f[y.name]=this._curOriginalData[o++],m[y.name]=this._curOriginalData[o++],this._curOriginalData[o++],this._curOriginalData[o++],this._curOriginalData[o++],this._curOriginalData[o++]}var g;0==this._aniMode||1==this._aniMode?this.graphics=new l:this.graphics.clear(),g=this.graphics;var x=NaN,v=NaN;for(u=0,p=this._boneSlotArray.length;p>u;u++)a=this._boneSlotArray[u],x=f[a.name],v=m[a.name],isNaN(v)||(g.save(),g.alpha(v)),isNaN(x)||a.showDisplayByIndex(x),a.draw(g,2==this._aniMode),isNaN(v)||g.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,this._clipIndex,g):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,this._clipIndex,g)},s.getAnimNum=function(){return this._templet.getAnimationCount()},s.getAniNameByIndex=function(t){return this._templet.getAniNameByIndex(t)},s.getSlotByName=function(t){return this._boneSlotDic[t]},s.showSkinByName=function(t){this._templet.showSkinByName(this._boneSlotDic,t),this._clearCache()},s.showSkinByIndex=function(t){this._templet.showSkinByIndex(this._boneSlotDic,t),this._clearCache()},s.showSlotSkinByIndex=function(t,i){if(0!=this._aniMode){var e=this.getSlotByName(t);e&&e.showDisplayByIndex(i),this._clearCache()}},s.setSlotSkin=function(t,i){if(0!=this._aniMode){var e=this.getSlotByName(t);e&&e.replaceSkin(i),this._clearCache()}},s._clearCache=function(){if(1==this._aniMode)for(var t=0,i=this._graphicsCache.length;i>t;t++)this._graphicsCache[t].length=0},s.play=function(t,i,a){void 0===a&&(a=!0);var n=-1,s=NaN;if(s=i?Number.MAX_VALUE:0,"string"==typeof t)for(var r=0,h=this._templet.getAnimationCount();h>r;r++){var l=this._templet.getAnimation(r);if(l&&t==l.name){n=r;break}}else n=t;n>-1&&n<this.getAnimNum()&&(a||this._pause||this._currAniIndex!=n)&&(this._currAniIndex=n,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(n)),this._player.play(n,1,s),this._templet.showSkinByIndex(this._boneSlotDic,0),this._pause&&(this._pause=!1,this._lastTime=y.now(),e.stage.frameLoop(1,this,this._update,null,!0)))},s.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),e.timer.clear(this,this._update))},s.playbackRate=function(t){this._player&&(this._player.playbackRate=t)},s.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),e.timer.clear(this,this._update))},s.resume=function(){this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=y.now(),e.stage.frameLoop(1,this,this._update,null,!0))},s._getGrahicsDataWithCache=function(t,i){return this._graphicsCache[t][i]},s._setGrahicsDataWithCache=function(t,i,e){this._graphicsCache[t][i]=e},s.destory=function(){this._templet=null,this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,e.timer.clear(this,this._update)},n(0,s,"player",function(){return this._player}),n(0,s,"url",function(){return this._aniPath},function(t){this.load(t)}),i}(m);(function(t){function i(t){this._start=0,this._Pos=0,this._data=null,this._curIndex=0,this._playIndex=0,this._playing=!1,this._ended=!0,this._count=0,this._ids=null,this._idOfSprite=null,this._parentMovieClip=null,this._movieClipList=null,this._labels=null,this.basePath=null,this.interval=30,this.loop=!1,i.__super.call(this),this._ids={},this._idOfSprite=[],this._reset(),this._playing=!1,this._parentMovieClip=t,t?(this._movieClipList=t._movieClipList,this._movieClipList.push(this)):(this._movieClipList=[this],this.on("display",this,this._$3__onDisplay),this.on("undisplay",this,this._$3__onDisplay))}a(i,"laya.ani.swf.MovieClip",t);var s=i.prototype;return s.destroy=function(i){void 0===i&&(i=!0),this.clear(),t.prototype.destroy.call(this,i)},s._$3__onDisplay=function(){this._displayInStage?e.timer.loop(this.interval,this,this.updates,null,!0):e.timer.clear(this,this.updates)},s.updates=function(){if(!this._parentMovieClip){var t=0,i=0;for(i=this._movieClipList.length,t=0;i>t;t++)this._movieClipList[t].update()}},s.addLabel=function(t,i){this._labels||(this._labels={}),this._labels[i]=t},s.removeLabel=function(t){if(t){if(!this._labels)for(var i in this._labels)if(this._labels[i]===t){delete this._labels[i];break}}else this._labels=null},s.update=function(){if(this._data&&this._playing){if(this._playIndex++,this._playIndex>=this._count){if(!this.loop)return this._playIndex--,void this.stop();this._playIndex=0}this._parse(this._playIndex),this._labels&&this._labels[this._playIndex]&&this.event("label",this._labels[this._playIndex])}},s.stop=function(){this._playing=!1},s.clear=function(){if(this._idOfSprite.length=0,!this._parentMovieClip){e.timer.clear(this,this.updates);var t=0,i=0;for(i=this._movieClipList.length,t=0;i>t;t++)this._movieClipList[t]!=this&&this._movieClipList[t].clear();this._movieClipList.length=0}this.removeChildren(),this.graphics=null,this._parentMovieClip=null},s.play=function(t,i){void 0===t&&(t=-1),void 0===i&&(i=!0),this.loop=i,this._data&&this._displayFrame(t),this._playing=!0},s._displayFrame=function(t){void 0===t&&(t=-1),-1!=t&&(this._curIndex>t&&this._reset(),this._parse(t))},s._reset=function(t){void 0===t&&(t=!0),t&&1!=this._curIndex&&this.removeChildren(),this._curIndex=-1,this._Pos=this._start},s._parse=function(t){var e,a,n,s=0,r=0,l=0,o=0,u=!1,_=this._idOfSprite,p=this._data;for(this._ended&&this._reset(),p.pos=this._Pos,this._ended=!1,this._playIndex=t,this._curIndex>t&&(this._curIndex=-1);this._curIndex<=t&&!this._ended;)switch(r=p.getUint16()){case 12:if(s=p.getUint16(),l=this._ids[p.getUint16()],this._Pos=p.pos,p.pos=l,0==(o=p.getUint8())){var c=p.getUint16();if(a=_[s],!a){a=_[s]=new m;var d=new m;d.loadImage(this.basePath+c+".png"),a.addChild(d),d.size(p.getFloat32(),p.getFloat32());var f=p._getMatrix();d.transform=f}a.alpha=1}else 1==o&&(e=_[s],e||(_[s]=e=new i(this),e.interval=this.interval,e._ids=this._ids,e.basePath=this.basePath,e._setData(p,l),e._initState(),e.play(0)),e.alpha=1);p.pos=this._Pos;break;case 3:this.addChild(_[p.getUint16()]).zOrder=p.getUint16(),u=!0;break;case 4:_[p.getUint16()].removeSelf();break;case 5:_[p.getUint16()][i._ValueList[p.getUint16()]]=p.getFloat32();break;case 6:_[p.getUint16()].visible=p.getUint8()>0;break;case 7:a=_[p.getUint16()];var y=new h(p.getFloat32(),p.getFloat32(),p.getFloat32(),p.getFloat32(),p.getFloat32(),p.getFloat32());a.transform=y;break;case 8:_[p.getUint16()].setPos(p.getFloat32(),p.getFloat32());break;case 9:_[p.getUint16()].setSize(p.getFloat32(),p.getFloat32());break;case 10:_[p.getUint16()].alpha=p.getFloat32();break;case 11:_[p.getUint16()].setScale(p.getFloat32(),p.getFloat32());break;case 98:n=p.getString(),this.event(n),"stop"==n&&this.stop();break;case 99:this._curIndex=p.getUint16(),u&&this.updateOrder(),this._playing&&this._curIndex>this._playIndex&&this.event("enterframe");break;case 100:this._count=this._curIndex+1,this._ended=!0,this._playing&&(this.event("enterframe"),this.event("end"),this.event("complete")),this._reset(!1)}this._Pos=p.pos},s._setData=function(t,i){this._data=t,this._start=i+3},s.load=function(t){var i=this;t=r.formatURL(t),this.basePath=t.split(".swf")[0]+"/image/",this.stop(),this.clear(),this._movieClipList=[this];var e=u.getRes(t);if(e)this._initData(e);else{var a=new u;a.once("complete",null,function(t){i._initData(t)}),a.load(t,"arraybuffer")}},s._initState=function(){for(this._reset(),this._ended=!1;!this._ended;)this._parse(++this._playIndex)},s._initData=function(t){this._data=new p(t);var i=0,a=this._data.getUint16();for(i=0;a>i;i++)this._ids[this._data.getInt16()]=this._data.getInt32();this.interval=1e3/this._data.getUint16(),this._setData(this._data,this._ids[32767]),this._initState(),this.play(0),this._parentMovieClip||e.timer.loop(this.interval,this,this.updates,null,!0),this.event("loaded")},n(0,s,"index",function(){return this._playIndex},function(t){this._playIndex=t,this._displayFrame(this._playIndex),this._labels&&this._labels[t]&&this.event("label",this._labels[t])}),n(0,s,"url",null,function(t){this.load(t)}),n(0,s,"count",function(){return this._count}),i._ValueList=["x","y","width","height","scaleX","scaleY","rotation","alpha"],i})(m)}(window,document,Laya);